{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dave's Notebook • All posts by \"xhtml\" tag",
    "description": null,
    "home_page_url": "http://davembush.github.com",
    "items": [
        {
            "id": "http://davembush.github.com/itextsharp-%E2%80%93-html-to-pdf-%E2%80%93-parsing-html/",
            "url": "http://davembush.github.com/itextsharp-%E2%80%93-html-to-pdf-%E2%80%93-parsing-html/",
            "title": "iTextSharp – HTML to PDF – Parsing HTML",
            "date_published": "2009-07-28T11:03:54.000Z",
            "content_html": "<p><img src=\"/uploads/2009/07/iStock_000004663193Medium.jpg\" alt=\"iStock_000004663193Medium\" title=\"iStock_000004663193Medium\"></p>\n<p>Now that we have the HTML cleaned up, the next thing we will want to do is to parse the HTML.</p>\n<p>In my actual code for this, I parse the HTML and create the PDF at the same time, but for the purposes of these posts, I’m going to deal primarily with parsing the HTML here and then deal with the PDF creation code later.</p>\n<p>The key to parsing the HTML is that it is in XHTML form.  This allows us to use the XML APIs that are built into .NET.  For the purposes of parsing the HTML so that we can convert it to PDF code, we need to use the XMLTextReader.</p>\n<p>Every time you Read() an XMLTextReader object, you will either be on a beginning tag, an ending tag, or text.  So the core of our loop looks something like this</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XmlTextReader reader =</span><br><span class=\"line\">    <span class=\"keyword\">new</span> XmlTextReader(xhtmlString,</span><br><span class=\"line\">        XmlNodeType.Element, <span class=\"literal\">null</span>);</span><br><span class=\"line\"><span class=\"keyword\">while</span> (reader.Read())</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (reader.NodeType)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> XmlNodeType.Element:</span><br><span class=\"line\">            <span class=\"comment\">// appropriate code break;</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> XmlNodeType.EndElement:</span><br><span class=\"line\">            <span class=\"comment\">// appropriate code break;</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> XmlNodeType.Text:</span><br><span class=\"line\">            <span class=\"comment\">// appropriate code break;</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> XmlNodeType.Whitespace:</span><br><span class=\"line\">            <span class=\"comment\">// appropriate code break;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>where xhtmlString is the cleaned up HTML code from last week.</p>\n<p>The core part of the translation is dependent on the fact that we have matching open and closing tags and that each time we hit an open tag, we can determine what the characteristics of that tag are.  Bold, underline, font, font size, etc.</p>\n<p>So each time we hit the open tag, we will look up the characteristics.  For simplicity, I put this information in a resource file so that I could just look it up using code that looks something like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fontName = Resources.html2pdf .ResourceManager</span><br><span class=\"line\">    .GetString(tagName + <span class=\"string\">&quot;_fontName&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>rather than having another long case statement in my code.</p>\n<p>Once we have the information we want from the resource file, we place the current characteristics on a stack.  I created a different stack for each element, but in hindsight, it might have been better to create a structure with the information and use one stack of type in that structure.</p>\n<p>Here’s the code that does that</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (!reader.IsEmptyElement)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    fontName = Resources.html2pdf.</span><br><span class=\"line\">        ResourceManager.</span><br><span class=\"line\">        GetString(tagName + <span class=\"string\">&quot;_fontName&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fontName != <span class=\"literal\">null</span>)</span><br><span class=\"line\">        currentFontName = fontName;</span><br><span class=\"line\">    fontSize = Resources.html2pdf.</span><br><span class=\"line\">        ResourceManager.</span><br><span class=\"line\">        GetString(tagName + <span class=\"string\">&quot;_fontSize&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fontSize != <span class=\"literal\">null</span>)</span><br><span class=\"line\">        currentFontSize = System.</span><br><span class=\"line\">            Convert.ToSingle(fontSize);</span><br><span class=\"line\">    fontColor = Resources.html2pdf.</span><br><span class=\"line\">        ResourceManager.</span><br><span class=\"line\">        GetString(tagName + <span class=\"string\">&quot;_fontColor&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fontColor != <span class=\"literal\">null</span>)</span><br><span class=\"line\">        currentFontColor = fontColor;</span><br><span class=\"line\">    fontCharacteristics = Resources.html2pdf.</span><br><span class=\"line\">        ResourceManager.</span><br><span class=\"line\">        GetString(tagName + <span class=\"string\">&quot;_fontCharacteristics&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fontCharacteristics != <span class=\"literal\">null</span>)</span><br><span class=\"line\">        currentFontCharacteristics =</span><br><span class=\"line\">            fontCharacteristics;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Note that we only push the attributes of the element onto the stack if there is no content in the element.  This is because the closing node type will never be triggered on an element that has no content inside of it (BR and IMG tags, for example).</p>\n<p>The final thing you’ll need to keep track of is if the element is a block element (P, DIV, etc) an inline tag (SPAN, A, etc) a list (OL,UL,LI), or even how much indentation is needed (primarily for list).</p>\n<p>Frankly, the code for this was not fun to write.  Keep in mind too that there is nothing in here to handle special font characteristic attributes.  So your DIV tags can’t specify what font they should use or even how wide the font should be.  Not because it can’t be done, but because I have not had the need.</p>\n<p>Here’s that code</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">strIndent = Resources.html2pdf.ResourceManager.GetString(tagName + <span class=\"string\">&quot;_indent&quot;</span>);</span><br><span class=\"line\">isBlock = Resources.html2pdf.ResourceManager.GetString(tagName + <span class=\"string\">&quot;_isBlock&quot;</span>);</span><br><span class=\"line\"><span class=\"built_in\">string</span> isList = Resources.html2pdf.ResourceManager.GetString(tagName + <span class=\"string\">&quot;_isList&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (isBlock != <span class=\"literal\">null</span> &amp;&amp; isBlock.ToLower() == <span class=\"string\">&quot;true&quot;</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">string</span> strIsList =</span><br><span class=\"line\">        Resources.html2pdf .ResourceManager</span><br><span class=\"line\">        .GetString(tagName + <span class=\"string\">&quot;_isULList&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (strIsList != <span class=\"literal\">null</span> &amp;&amp;</span><br><span class=\"line\">        strIsList.ToLower() == <span class=\"string\">&quot;true&quot;</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        p = <span class=\"keyword\">new</span> List(<span class=\"literal\">false</span>,</span><br><span class=\"line\">            System.Convert .ToSingle(strIndent));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        strIsList = Resources</span><br><span class=\"line\">            .html2pdf.ResourceManager</span><br><span class=\"line\">            .GetString(tagName + <span class=\"string\">&quot;isOLList&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (strIsList != <span class=\"literal\">null</span> &amp;&amp; strIsList.ToLower() == <span class=\"string\">&quot;true&quot;</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            p = <span class=\"keyword\">new</span> List(<span class=\"literal\">true</span>,</span><br><span class=\"line\">                System.Convert.ToSingle(strIndent));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isList != <span class=\"literal\">null</span> &amp;&amp; isList.ToLower() == <span class=\"string\">&quot;true&quot;</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                p = <span class=\"keyword\">new</span> iTextSharp.text.ListItem();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                p = <span class=\"keyword\">new</span> Paragraph();</span><br><span class=\"line\">                ((Paragraph)p)</span><br><span class=\"line\">                    .SetLeading(m_leading, <span class=\"number\">1</span>);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (stack.Count != <span class=\"number\">0</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    IElement e = stack.Pop();</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isList != <span class=\"literal\">null</span> &amp;&amp; isList.ToLower() == <span class=\"string\">&quot;true&quot;</span>)</span><br><span class=\"line\">        ((iTextSharp.text.List)</span><br><span class=\"line\">            (list[list.Count - <span class=\"number\">1</span>])).Add(p);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> list.Add(p);</span><br><span class=\"line\">    stack.Push(p);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You’ll notice that there is a bit of code in here that deals with a p variable.  This code is needed so that if we are dealing with a block tag, we have a paragraph or list item to put the other content inside of the block when we hit it.  If we are dealing with an inline tag, we deal with that when we add the text.</p>\n<p>Next week, we will show how to handle text and closing tags.</p>\n",
            "tags": [
                "c#",
                "asp.net",
                "html",
                "iTextSharp",
                "PDF",
                "parsing",
                "xhtml"
            ]
        }
    ]
}