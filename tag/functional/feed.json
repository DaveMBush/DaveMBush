{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dave's Notebook • All posts by \"functional\" tag",
    "description": null,
    "home_page_url": "http://davembush.github.com",
    "items": [
        {
            "id": "http://davembush.github.com/how-to-avoid-binding-to-computed-values-in-angular/",
            "url": "http://davembush.github.com/how-to-avoid-binding-to-computed-values-in-angular/",
            "title": "How to Avoid Binding to Computed Values in Angular",
            "date_published": "2021-05-08T15:55:53.000Z",
            "content_html": "<p>In my previous article about <a href=\"../optimizing-angular-for-speed/\">Angular Performance</a>, I indicated that one of the many ways you can produce an Angular application that performs well is by ensuring that you bind to a computed value.</p>\n<p>First, what did I mean by that?</p>\n<span id=\"more\"></span>\n\n<p>There two ways you might bind to a computed value.</p>\n<p>The most obvious way is by calling a method in the template’s corresponding class. But, properties count to. To be clear, a property is some code that uses a <code>get</code> prefix.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">get</span> <span class=\"title function_\">somePropertyNameHere</span>() &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;something here&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Now, you might think you need to avoid this when you use the square brackets to assign a variable to a component property, but this also goes for ngIf and ngFor code as well.</p>\n<p>What we are striving for is to not have the template recompute anything unless the data has actually changed.</p>\n<p>The only exception to this is the ngFor trackBy attribute which is used to ensure the whole list doesn’t re-render just because the array changed. I’m assuming you are using this.</p>\n<p>But, you say, I NEED to compute those values in order to display them correctly.</p>\n<p>OK, let’s assume for a second that this is true. The way you do this is with pipes.</p>\n<h2 id=\"Pipes\"><a href=\"#Pipes\" class=\"headerlink\" title=\"Pipes\"></a>Pipes</h2><p>You should already be familiar with pipes because this is how we format dates, format numbers and subscribe to observables in the template.  But you aren’t limited to using the built-in pipes. You can create your own, and it is quite easy to do.</p>\n<p>All you need is a class with the <code>@pipe</code> attribute that implements the <code>PipeTransform</code> interface.</p>\n<p>The code you would normally place in the method of property of your component class can go in here instead.</p>\n<p>By doing this, Angular can see that the variable that is passed to it has changed, or not, and can determine when the code needs to be recomputed.</p>\n<h2 id=\"ngOnChanges\"><a href=\"#ngOnChanges\" class=\"headerlink\" title=\"ngOnChanges()\"></a>ngOnChanges()</h2><p>Another way you might achieve the same goal is by trapping the <code>ngOnChanges()</code> event for the component.</p>\n<p>Many times, any value that we would compute in a method or property to be pulled from the template is only going to change if an <code>@input</code> value changed.</p>\n<p>Instead of pulling the value and computing it on every change detection cycle, you can listen for the dependency during the <code>ngOnChanges</code> event and assign the new value to a class field and have your template look at the field instead.</p>\n<p>Be careful though. If you are lazy and recompute the field every time <code>ngOnChanges()</code> is called, you really haven’t gained anything by it.  <code>ngOnChanges()</code> will pass into you exactly what changed and you can use that to determine if the value should be recomputed.</p>\n<h2 id=\"NgRX-Store-Selector\"><a href=\"#NgRX-Store-Selector\" class=\"headerlink\" title=\"NgRX Store Selector\"></a>NgRX Store Selector</h2><p>My favorite means of achieving the goal of not calling computed values is by using NgRX Store Selectors.</p>\n<p>When you are new to NgRX you may only be using the simple selector.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> observerThing = <span class=\"variable language_\">this</span>.<span class=\"property\">store</span>.<span class=\"title function_\">pipe</span>(<span class=\"title function_\">select</span>(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> x.<span class=\"property\">storeSlice</span>));</span><br></pre></td></tr></table></figure>\n\n<p>And of course you can drill down from storeSlice into children if you need to.</p>\n<p>If you’ve graduated to Feature Selectors, your code may have graduated to:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> observerThing = <span class=\"variable language_\">this</span>.<span class=\"property\">store</span>.<span class=\"title function_\">pipe</span>(<span class=\"title function_\">select</span>(featureSelector));</span><br></pre></td></tr></table></figure>\n\n<p>where <code>featureSelector</code> looks something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">createSelector</span>(</span><br><span class=\"line\">  <span class=\"title function_\">createFeatureSelector</span>(<span class=\"string\">&#x27;feature&#x27;</span>),</span><br><span class=\"line\">  <span class=\"function\"><span class=\"params\">x</span> =&gt;</span> x.<span class=\"property\">featureSlice</span>);</span><br></pre></td></tr></table></figure>\n\n<p>but there are other uses for <code>createSelector</code>.</p>\n<p>You can use it to combine slices:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">createSelector</span>(</span><br><span class=\"line\">  slice1Selector,</span><br><span class=\"line\">  slice2Selector,</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">s1, s2</span>) =&gt;</span> combineLogicGoesHere</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>Or, you can use it to create a selector for a specific bit of information.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">createSelector</span>(</span><br><span class=\"line\">  sliceSelector,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"params\">s1</span> =&gt;</span> s1.<span class=\"property\">s1Part</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>And by combining this, we can create a selector that does our formatting for us only when the underlying data has changed.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> partSelector = <span class=\"title function_\">createSelector</span>(</span><br><span class=\"line\">  sliceSelector,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"params\">s1</span> =&gt;</span> s1.<span class=\"property\">s1Part</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> formatedPart = <span class=\"title function_\">createSelector</span>(</span><br><span class=\"line\">  partSelector,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"params\">ps</span> =&gt;</span> <span class=\"title function_\">formatPsHere</span>(ps)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>And now, our template can listen to this the same as it would listen to any other selector.</p>\n<p>This is the method I most prefer. By pushing this code down into a selector, I don’t have to be concerned with explicitly detecting what has changed. I let the selector do that for me. I just respond to the change when it happens.</p>\n",
            "tags": [
                "angular",
                "ngrx",
                "functional",
                "reactive",
                "mvp"
            ]
        },
        {
            "id": "http://davembush.github.com/an-angular-application-architecture-that-works/",
            "url": "http://davembush.github.com/an-angular-application-architecture-that-works/",
            "title": "An Angular Application Architecture That Works",
            "date_published": "2020-01-01T16:55:53.000Z",
            "content_html": "<p>The purpose of this article is to specify a working architecture that everyone can use for any Angular applications.  This architecture aims to achieve the following goals:</p>\n<ul>\n<li>Ensure that all parts of an application have a home so that anyone can pick up any application that uses this architecture and modify the application without having to learn where everything lives.</li>\n<li>Reduce the overall complexity of any one application by using well-established design patterns that work within the Angular ecosystem.</li>\n<li>Reduce the number of bugs introduced into an application by reducing the need for duplicate code.</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"Guiding-Principles\"><a href=\"#Guiding-Principles\" class=\"headerlink\" title=\"Guiding Principles\"></a>Guiding Principles</h2><ul>\n<li>Largely adhere to the <a href=\"https://angular.io/guide/styleguide\">Angular Style Guide</a></li>\n<li>Prefer Functional&#x2F;Reactive programming over Imperative&#x2F;Object Oriented programming.</li>\n<li>Prefer Composition over Inheritance when using Object Oriented programming</li>\n<li>For Object Oriented code, and where it applies, Functional&#x2F;Reactive code, make your code S..D<ul>\n<li>Adhere to the Single Responsibility Principle:<ul>\n<li>Keep the size of the individual files (html, css, ts) small</li>\n<li>Separate file for each class, function, interface, enum, etc.</li>\n<li>Keep the cyclomatic complexity of functions and methods small.</li>\n</ul>\n</li>\n<li>Keep your code DRY</li>\n<li>Because we prefer Composition over Inheritance, the OLI part of SOLID don’t apply.</li>\n</ul>\n</li>\n<li>Prefer composition over child routes.</li>\n</ul>\n<h2 id=\"Directory-Structure\"><a href=\"#Directory-Structure\" class=\"headerlink\" title=\"Directory Structure\"></a>Directory Structure</h2><p>Let’s start with the directory structure our applications will use.  To start with, the directory structure outlined in the <a href=\"https://angular.io/guide/styleguide\">Angular Style Guide</a> should be used with some minor modifications that still obey the general principles outlined in the style guide.</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">projectFolder</span><br><span class=\"line\">+- src</span><br><span class=\"line\">  +- core</span><br><span class=\"line\">  +- dialogs</span><br><span class=\"line\">    +- dialog1</span><br><span class=\"line\">      +- helper-component-1</span><br><span class=\"line\">      +- helper-component-2</span><br><span class=\"line\">      main dialog files go here directly</span><br><span class=\"line\">      under the dialog directory</span><br><span class=\"line\">        - html, css, ts</span><br><span class=\"line\">        - dialog specific NgRX code</span><br><span class=\"line\">    +- dialog2</span><br><span class=\"line\">      +- helperComponent3</span><br><span class=\"line\">      main dialog files go here</span><br><span class=\"line\">    +- etc...</span><br><span class=\"line\">  +- routes</span><br><span class=\"line\">    +- route-1</span><br><span class=\"line\">      +- supporting-component-1</span><br><span class=\"line\">      +- store</span><br><span class=\"line\">        supporting route specific NgRX files go here</span><br><span class=\"line\">        these include actions, effects, services, reducers,</span><br><span class=\"line\">        and selectors.  Each set of files get their own</span><br><span class=\"line\">        directory. The extensions for each are:</span><br><span class=\"line\">        - *.actions.ts</span><br><span class=\"line\">        - *.effects.ts</span><br><span class=\"line\">        - *.service.ts</span><br><span class=\"line\">        - *.reducer.ts</span><br><span class=\"line\">        - *.selector.ts</span><br><span class=\"line\">        route store slice module goes here</span><br><span class=\"line\">      route1 components go here</span><br><span class=\"line\">      route1 module goes here</span><br><span class=\"line\">    +- route-1-subroute-a</span><br><span class=\"line\">      similar to above.  This is only IF you have sub-routes.</span><br><span class=\"line\">      I strongly advise against them.</span><br><span class=\"line\">  +- shared</span><br><span class=\"line\">    +- components</span><br><span class=\"line\">      only components that are shared between routes go here</span><br><span class=\"line\">    +- store</span><br><span class=\"line\">      only store files that are shared between routes go here</span><br><span class=\"line\">    +- services</span><br><span class=\"line\">      only services, if any, that aren&#x27;t used by your store go here</span><br></pre></td></tr></table></figure>\n\n<p>What is slightly different from the style guide is that a separate directory is created for dialogs and routes as these will be where my top-level components will live.  Within a route or a dialog, everything that route or dialog needs should live under it.  In the case where a class is needed by multiple routes or dialogs, these files live under shared.</p>\n<p>As a guiding principle, you should think of each route as a stand-alone application with its own module.  It should be able to run on its own using the classes, functions, etc from either its directory and sub-directories or the classes, functions, etc in the shared directory.</p>\n<p>This leads us to Lazy Loading</p>\n<h2 id=\"Lazy-Loading\"><a href=\"#Lazy-Loading\" class=\"headerlink\" title=\"Lazy Loading\"></a>Lazy Loading</h2><p>While it is possible to create an application where the routes are all specified in one file, this file will quickly get out of hand if you are working with a large application.  You can save yourself a lot of trouble and reduce the cognitive load necessary to digest one file with all the routes if you commit to lazy loading up front.</p>\n<h3 id=\"Routes\"><a href=\"#Routes\" class=\"headerlink\" title=\"Routes\"></a>Routes</h3><p>What this means from a practical perspective is that each route will be loaded in as it is needed. One of the side benefits of this is that the files necessary to run each route will only be loaded as they are needed. This will decrease the time it takes to load the application.</p>\n<p>You will, however, need to ensure that each route can be loaded directly because sometimes taking the expected path will load modules that you forgot to load as part of the route.</p>\n<h3 id=\"NgRX\"><a href=\"#NgRX\" class=\"headerlink\" title=\"NgRX\"></a>NgRX</h3><p>Similarly, you should make use of feature stores in NgRX so that you can dynamically add in store slices with each module rather than loading them all in when the application loads.  Done correctly, this will also reduce the cognitive load around your store structure as you will only need to be concerned about the store structure for each route.</p>\n<p>For consistency’s sake, I create feature slices in my shared folder for NgRX slices that are shared rather than load them all at the application level. Again, this reduces the cognitive load necessary to understand any one part of the application. It has the added benefit of making it easier to move slices of the store from a route feature to a shared feature because the structure remains essentially the same.</p>\n<h2 id=\"Components\"><a href=\"#Components\" class=\"headerlink\" title=\"Components\"></a>Components</h2><p>A large part of the front-end code is written using components which include the route, controls, and components that encompass blocks of components.</p>\n<p>The following addresses how to create components in a way that can be maintained.</p>\n<h3 id=\"Keep-em-Small\"><a href=\"#Keep-em-Small\" class=\"headerlink\" title=\"Keep em Small\"></a>Keep em Small</h3><p>One of the main problems I’ve seen in my career with all code, but especially components, is that we try to put all the code for a page all in one place. We don’t even think of the third category of components.  My advice for your template code is that once it has gotten past the point of code that can’t fit in a file that is 150 lines long and 80 characters wide, or has nested to a point beyond 6 elements, you should consider breaking them out. There may be a few exceptions, but this metric will keep your code easy to understand.</p>\n<p>One way you can reduce the nesting without a lot of effort is to style the @host element of the template rather that using a containing DIV tag around the other elements that are the functional components of your component.  Other than because it reduces nesting, it also eliminates a layer of HTML that needs to be rendered. Since we are going to favor lots of small components over a few large components, this will, ultimately, impact the performance of your application.</p>\n<p>Another way you can reduce nesting is by recognizing patterns in your code and extracting them into their own component.</p>\n<p>Finally, consider measuring the cyclomatic complexity of your templates.  Codelyzer has a rule you can add to your linting.  I’d set this to no more than 10.  Cyclomatic complexity measures how many paths there are through your code.  Once you’ve added if, switch or for loops in your template, you’ve introduced some cyclomatic complexity. If you keep to the metrics I’ve already mentioned, you should never hit the cyclomatic complexity metric.</p>\n<h3 id=\"Component-Services\"><a href=\"#Component-Services\" class=\"headerlink\" title=\"Component Services\"></a>Component Services</h3><p>Let’s talk about the purpose of components for a bit. The point of components is to allow the end user to interact with the program. In practical terms this means it has two jobs:</p>\n<ul>\n<li>Display data that is meaningful to the user</li>\n<li>Allow the user to issue commands that either manipulate the data or take them to another screen.</li>\n</ul>\n<p>This is true for whatever programming environment you are using.</p>\n<p>I’ve been programming now for 32 years and I still see programmers who try to make the component, or the view as they are sometimes called, do something else.</p>\n<p>This also means that business rules have no place in a component.</p>\n<p>Having said that, it is often true that to get the data to display we often need to introduce logic into our component somewhere. Once we’ve introduced logic, it would be great if we could also write unit tests for that logic without a lot of pain.</p>\n<p>If we put this code in the TS file that is our component, this means that in order to test the logic we need to scaffold the component.  Wouldn’t it be better or at least easier, if we didn’t need the component at all?</p>\n<p>This is where component services come in.  If you are familiar with the Model View Presenter design pattern, this is an adaptation of that.</p>\n<p>You can read details of how this is implemented on the following two sites:</p>\n<ul>\n<li><a href=\"https://davembush.github.io/model-view-presenter-angular-and-testing/\">Model View Presenter, Angular, and Testing</a></li>\n<li><a href=\"https://dev.to/this-is-angular/model-view-presenter-with-angular-533h\">Model View Presenter with Angular</a></li>\n</ul>\n<p>The basic idea is that you leave the component as the thing that only presents the data and receives notifications from the user. Any logic that is needed goes into an Angular service that is registered with the component using the viewProviders property of the @Component decorator.</p>\n<p>One thing to be careful of here is that you may be tempted, as I have been for a while, to pull the information from the service up into the view. The problem with this is that it is not an optimal implementation for change detections.</p>\n<p>The preferred method would be to use the model as it was originally intended and have the service set fields in the presentation layer so that change detection only happens when the data actually changes rather than every time the component is checked simply because your data has to be computed in a property or method every time.</p>\n<p>And while we are discussing change detection, you should also avoid changing the state of your component internally. By using OnPush notification, all changes have to come in on an <code>@Input()</code> field for the component to know it has to do change detection. You can, of course, get around this by using <code>markForCheck()</code> but the disadvantage there is that you may force change detection more often than it is actually needed.</p>\n<p>This is why we prefer the smart component&#x2F;dumb component model. It forces many of these issues. To do this properly, you’ll probably need to create child components so you can take advantage of the <code>@Input()</code> fields.</p>\n<h3 id=\"Smart-x2F-Dumb\"><a href=\"#Smart-x2F-Dumb\" class=\"headerlink\" title=\"Smart&#x2F;Dumb\"></a>Smart&#x2F;Dumb</h3><p>Broadly speaking, Angular components can be classified as “Smart Components” or “Dumb Components”.  Smart Components get their data form the outside world and pass data out to the outside world.  In the architecture defined here, that will be from the NgRX store via selectors and into the NgRX store using Actions.</p>\n<p>Dumb Components render data they are passed via the @Input() decorators and fire events back up to the containing component via @Output() decorators.</p>\n<p>A lot of people understand these concepts but misunderstand how they apply to an Angular application. You can’t follow these rules simply by wrapping your Dumb Components in Smart Components. While this technically obeys the definition, the result is code that is hard to understand. What we want is a central location in our code that is always responsible for getting data to and from the store.</p>\n<p>We do this by specifying that our Routes are the Smart Components.  This includes child routes, if you have them.</p>\n<p>I’ve found that it is often easier to make a dialog a smart component as well, so if you find this is easier than passing the data that the dialog needs to the dialog, you can make dialogs smart as well. This is why we have a <code>dialogs</code> directory and a <code>routes</code> directory as immediate children of the <code>app</code> directory.</p>\n<h3 id=\"Forms\"><a href=\"#Forms\" class=\"headerlink\" title=\"Forms\"></a>Forms</h3><p>Technically, there are two ways of programming forms using Angular. The first way uses the old 2-way data-binding model and is called “Templated Forms.” These were popular in AngularJS (aka Angular 1).  The second is new to Angular (aka Angular 2+) and is called “Reactive Forms”. Our architecture will use the newer model because it conforms to the guiding principle of keeping things as Functional as possible and removing as much logic from the component as possible.</p>\n<p>There are several implications of how we program our forms related to this.</p>\n<p>First, you will define your FormGroup(s) in the Route’s component service.</p>\n<p>Second, in order to keep your templates small, you may be a need to put bits of your form in child components. You will find that each child component needs its own <code>formGroup</code> attribute around the <code>formControls</code> that it is responsible for.  The best way to do this is to pass the <code>formGroup</code> down from the router into the child components and then assign that variable to the <code>formGroup</code> attribute in the child component’s template.</p>\n<p>For particularly complex forms, I recommend creating a formGroup object as a separate file in each component’s directory and then use <code>Object.assign()</code> to concatenate the parts into one whole.  This keeps the related code together while allowing you to assemble them into a form that Angular can use.</p>\n<h3 id=\"onPush-Notification\"><a href=\"#onPush-Notification\" class=\"headerlink\" title=\"onPush Notification\"></a>onPush Notification</h3><p>One of the optimizations available to Angular is a method of change detection called “Push Notification”.  Simply stated, with Push Notification enabled, change detection for the component is only initiated if new data has been pushed into it via one of it’s @Input() variables. Otherwise it is skipped.</p>\n<p>In a large application, the performance gains using this mechanism are enormous. This is particularly true of an application that has an extremely nested or repetitive set of components. Each instance will be checked with each event that would cause the change detection cycle to kick off.</p>\n<p>Since we will be striving to keep our components small, our apps are even more susceptible to the problems associated with change detection.</p>\n<p>While it is true that Push Notification handles most of the situations, you will find that occasionally data in your component changes for some other reason. For this, you should use the ChangeDetectorRef methods.</p>\n<h3 id=\"Styling\"><a href=\"#Styling\" class=\"headerlink\" title=\"Styling\"></a>Styling</h3><p>In an ideal world, you would have a theme that is external to all of your projects and that can be <code>npm install</code>ed into all the projects you work on.  This should control the basic look and feel of your application including:</p>\n<ul>\n<li>font color, size, family etc</li>\n<li>background color</li>\n<li>default style for common components</li>\n</ul>\n<p>Lacking a separate project for your theming information, place this information in a global styles.css file.</p>\n<p>Under no circumstance would you ever place the above information directly in a component file within your application.</p>\n<p>Also, because all the main information is going to be in your theme, there is no benefit to using SCSS within your project. And, in fact, every project I’ve ever been a part of that tried to use SCSS as part of the project has become more of a mess and harder to maintain because of it.</p>\n<p>Use SCSS for your theme project and CSS for your application projects.</p>\n<h2 id=\"NgRX-1\"><a href=\"#NgRX-1\" class=\"headerlink\" title=\"NgRX\"></a>NgRX</h2><p>We’ve already addressed some of how NgRX should be used when we talked about using Features instead of one great big Store blob.</p>\n<p>But, there are some other major places where NgRX gets misused that need to be addressed.</p>\n<h3 id=\"One-to-One-vs-One-to-Many\"><a href=\"#One-to-One-vs-One-to-Many\" class=\"headerlink\" title=\"One to One vs One to Many\"></a>One to One vs One to Many</h3><p>If you are new to NgRX, one of the first things that will seem like a really good idea is that you should be able to create an action and have multiple Reducers or Effects respond to it. If you were to act on this impulse, you would (eventually) find that this ultimately makes your code hard to maintain because you are now calling multiple functions “at the same time.”</p>\n<p>From a maintenance perspective, this is a problem.  Imagine trying to track down the flow of execution in your application only to find that when you get to point X you now have to trace the action down multiple paths, not really knowing which ultimately is executing the code you are really interested in.</p>\n<p>But, you have a further hidden problem. The order those functions get called is, for all practical purposes, undefined. At least, from a programming perspective, they should be considered undefined. The order is probably deterministic for any particular version of NgRX that you are running, but when you upgrade there is no reason to believe the code will still execute in the same order.</p>\n<p>Similarly, your actions, reducers, and effects should only relate to each other. You shouldn’t have an action that is part of slice A being handled by slice B even if it is a one-to-one relationship.</p>\n<p>Some code I’ve seen has also aliased actions so that, technically action A is actually action B. Don’t do that! All the above make your code incredibly hard to track flow of control.</p>\n<p>If you were to do this, which I still don’t recommend, you should create actions that are clearly multi-use actions.</p>\n<p>So what if indeed a particular event needs to kick-off or update seperate slices of a store? The can be answered in a few ways.</p>\n<ul>\n<li><p>It may be worthwhile re-examining the architecture of your overall store. Is there a good rational for why a single Action will impact separate slices of a store in the first place? This is especially important if the resulting actions end up doing the same thing or are using the same data. If so, consider normalizing the store slices and removing redundancies.</p>\n</li>\n<li><p>If that passes the sniff test, consider dispatching different actions in sequence for that event. For example, you may be updating different parts of the application each with different information and structure or different service calls. Under this scenario, separate store slices will be updated via different store action sets and different information structures, regardless of whether they were initiated by the same event.</p>\n</li>\n</ul>\n<p>To reiterate, do not mix the various store slice actions just to intercept the same event.</p>\n<h3 id=\"Flat-Store\"><a href=\"#Flat-Store\" class=\"headerlink\" title=\"Flat Store\"></a>Flat Store</h3><p>Another temptation you may encounter when you start working with NgRX is that you’ll return data from the server in a nested format and then try to deal with it in your reducer in that form.</p>\n<p>Don’t do that!</p>\n<p>Instead, flatten the data into multiple slices and use the Selectors to reassemble the data when you need it.</p>\n<p>If you are going to flatten the data on the client side, you should use <a href=\"https://www.npmjs.com/package/normalizr\">Normalizr</a>. Or, you could use <a href=\"https://www.npmjs.com/package/normalizr\">NgRX-Normalizr</a> and let it do some of the work for you.</p>\n<p>If you have the option, you should flatten your data on the server before you return it. The main advantage to doing this is that you will return less data.</p>\n<p>The reason you want to work with a flat store is because of immutability. Because the store is immutable, or at least, it SHOULD be, you will need to ensure that when you change an element of the data the object pointers above it all change as well. If you don’t, your change detection mechanisms won’t work correctly.</p>\n<p>If you use Normalizr and reassemble the nesting in your selectors, you won’t have to deal with this mess.</p>\n<h3 id=\"Store-Everything\"><a href=\"#Store-Everything\" class=\"headerlink\" title=\"Store Everything\"></a>Store Everything</h3><p>You also may be tempted to only store some of your application state in the NgRX store.  Maybe you think storing search form data is overkill. That you’ll pass the data over as it is needed. That might work, for a while.</p>\n<p>But think about this. Once you’ve placed the data in the store, when you come back to a particular route, the data is still there. If you don’t, the data is gone and you have to fill in the form again.</p>\n<p>You might say, “But that’s what I want them to do.” Yes, but, what if the customer changes their mind? Now you have options.</p>\n<p>Another advantage to the “Store Everything” approach is that you’ve pushed the logic for handling the data changes further down the stack. One place this becomes noticeable is that when you decide to process the data, you no longer have to pass the data with the Action to process the data. The Effect that processes the Action can now retrieve the data from the store.</p>\n<p>If nothing else, this makes the code easier to test.  Code that is easier to test is code that is easier to maintain, even if you never write any test for the code.</p>\n<h3 id=\"Data-Transformation\"><a href=\"#Data-Transformation\" class=\"headerlink\" title=\"Data Transformation\"></a>Data Transformation</h3><p>There are two places where data transformations might need to occur.  The first is after we retrieve the data or right before we send the data back. In an ideal world the server would always send back exactly what we need in the form we need it and we would send it back in a similar form. There are at least two advantages to this.  The first is that it will reduce the amount of processing that the client side code has to perform. Second, the data that that comes back will be generally smaller.</p>\n<p>The second place is as we are working with the data on the client side.</p>\n<p>One scenario where this would occur is when you update a field and the side effect is that data someplace else on the screen should change as well. Not because you retrieved data from somewhere but simply because you changed data in an input field.</p>\n<p>As I’ve already mentioned, we want to keep processing of data out of our components or even our component services unless the processing is specific to what the component does. The next logical place to put the processing of our store data is in our reducers.  But this has problems too. Maybe the data you want to display has no resemblance to the data that is in your store. Beyond that, this gets difficult to manage.</p>\n<p>Instead, the best place to handle data transformation is in your selector. Selectors have a function call as their last parameter that takes all the data slices from the previous parameters. This function can manipulate the data and return it in any way that makes sense for the application. It has the added advantage of being able to leverage memoization and changing the object pointer as I’ve already mentioned.</p>\n<h3 id=\"Services\"><a href=\"#Services\" class=\"headerlink\" title=\"Services\"></a>Services</h3><p>A final temptation may be to ditch the Services that the Effects use and go after the REST end points directly. This seems to make sense since the Effects and the Services are both <code>@Injectable()</code>s but the problem with this is primarily that it violates the Single Responsibility Principle.</p>\n<p>For retrieval of data, the Service is responsible for retrieving the data and possibly morphing it into the shape that we want it in. The Effect is primarily responsible for moving the resulting data into the store.</p>\n<p>The reverse is also true. Effects are responsible for collecting the data from wherever it is in the store and passing it to the Service.  The Service is responsible for sending that data to the server in the form that it needs it.</p>\n<p>One error I’ve seen is to inject the Store into the Service. The only <code>@Injectable()</code> that should be injected into your HTTP Service is HttpClient.</p>\n<h2 id=\"Angular-as-Functional-x2F-Reactive\"><a href=\"#Angular-as-Functional-x2F-Reactive\" class=\"headerlink\" title=\"Angular as Functional&#x2F;Reactive\"></a>Angular as Functional&#x2F;Reactive</h2><p>At the beginning of this article, I said one of the guiding principles of how we code is that we prefer Functional&#x2F;Reactive programming over Imperative&#x2F;Object Oriented programming.</p>\n<p>What does that mean?</p>\n<p>Imperative programming is code most of us are familiar with. It is code that says, do this, then do that, then do something else. Everything happens in sequence and it is very clear what happens when because the code says so.</p>\n<p>The problem with imperative programming is that it often contributes to tightly coupled code. In fact, this is the main reason Object Oriented code uses dependency injection and inversion of control.</p>\n<p>Object Oriented programming adds a layer on to imperative programming and tries to model everything in the world as a thing.  For example, a database Table, and User Interfaces are things. They lend themselves well to Object Oriented programming. By layering in dependency injection they decouple a lot of the code.</p>\n<p>But Object Oriented code still suffers from a problem. Not everything we are trying to write code for is a thing. Most of what we code is a process. Until recently, we’ve tried to shoehorn in a programming model that works for things and tried to make processes things somehow. It hasn’t worked well.</p>\n<p>Another problem with Imperative&#x2F;Object Oriented programming is that it mutates memory and each function can return different values even though I’ve passed in the same values. This can make this model difficult to test.</p>\n<p>Think about it, which would you rather write a test for?  Code that given the same parameters always returns the same value, or code that is indeterminate.</p>\n<p>But wait, you say, all code is deterministic. Or is it?</p>\n<p>Take for example a method in a class that has two member variables.  The method itself takes a parameter and makes a call out to a database. How many possible return values are there for any given value we pass in?</p>\n<p>Well, here’s the problem, you actually have 4 parameters and one of these is difficult to control. Oh, sure, you could mock the call to the database and get some control. But if you could write code that didn’t require taming, wouldn’t that be helpful?</p>\n<p>Which leads us to Functional Programming. In Functional Programming we have a number of key advantages. First any given function passed the same parameters always returns the same value. Testing issues solved! Second, strictly functional code has no variables. As one article I read states, “You can’t screw up what you can’t change.” Third, everything is a function.</p>\n<p>This is an oversimplification, you can read more on functional programming elsewhere. One final advantage that most of the literature doesn’t mention is that Functional Programming models processes better than Object Oriented programming. And because of the features I mentioned above, it is also much easier to test and much more deterministic.</p>\n<p>Which leads to Reactive. Aside from the fact that we are using RxJS in Angular which is a Reactive library, this also means that we react to “events” that get fired.  This is essentially what is happening when you dispatch an action in NgRX, what you are effectively saying is, “someone do this thing for me.”</p>\n<p>In the past, you would have just coded for that process to start. Here, that action could just as easily happen on some other computer, or at least some other thread. And so, instead of coding “do this, then that, then this other thing.”  You are coding, “when I get notified, I’m going to do this and then, optionally, notify the system that I’m done.”</p>\n<p>And so, we favor Functional&#x2F;Reactive programming because it makes our programs more stable but we admit that not everything can be done using a Functional&#x2F;Reactive model.</p>\n<h2 id=\"Data-over-Presentation\"><a href=\"#Data-over-Presentation\" class=\"headerlink\" title=\"Data over Presentation\"></a>Data over Presentation</h2><p>This is a specific instance of the previous point, but I want to call it out directly because I recognize that it is not quite as obvious to most people as it is to me.</p>\n<p>Most programmers, because they are still thinking in an imperative model, think of their code in terms of the presentation layer. What this means in terms of how they code is that when an event occurs in the view, they tend to fire an action. Sometimes this is the right thing to do. But, if the action that just occurred in the view also changed the state of your data in someway, it would make more sense to observe the data change in your store and react to it there than to fire off an event from the view to do the same thing.</p>\n<p>By following the rule of Data over Presentation, you benefit in two ways. The first is that more of your code will transfer to whatever JavaScript framework or library becomes popular in the future because RxJS is agnostic to which one you use.</p>\n<p>Second, by observing the data using <code>distinctUntilChanged()</code> you can ensure that you only respond when the data actually changed instead of every time it looks like there may have been a change.</p>\n",
            "tags": [
                "angular",
                "ngrx",
                "functional",
                "reactive",
                "mvp"
            ]
        },
        {
            "id": "http://davembush.github.com/enforce-typescript-functional-programming/",
            "url": "http://davembush.github.com/enforce-typescript-functional-programming/",
            "title": "Enforce TypeScript Functional Programming",
            "date_published": "2017-07-25T10:30:00.000Z",
            "content_html": "<p>As consistent readers of this blog are aware, I’ve fallen in love with Functional Programming.  But I also live in a primarily Angular&#x2F;TypeScript world where some code is still Object Oriented and other code is more Functional in nature.  And while TypeScript lets you do some Functional things, I’ve found it hard to force functional concepts in TypeScript.  So, I’ve gone searching.  Wouldn’t it be great if there were some sort of flag you could set that said, “Hey compiler, I’m in ‘Functional’ mode now!”  And the compiler would make sure that you never used a conditional statement, never accessed hidden parameters, and never mutated state? </p>\n<p>Well, I think I’ve figured out some of how to manage all of this using nothing more than TypeScript and some TSLint rules. <figure><img src=\"/uploads/2017/07/2017-07-25.jpg\"><figcaption>Photo credit: <a href=\"//www.flickr.com/photos/archer10/15127010075/\">archer10 (Dennis) 99M Views</a> via <a href=\"//visualhunt.com/re/52cd50\">VisualHunt.com</a> &#x2F; <a href=\"//creativecommons.org/licenses/by-sa/2.0/\"> CC BY-SA</a></figcaption></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"Immutability\"><a href=\"#Immutability\" class=\"headerlink\" title=\"Immutability\"></a>Immutability</h2><p>Several weeks ago, I demonstrated how to <a href=\"/really-use-ngrx-better/\">protect against immutability using freeze</a>.  But, wouldn’t it be better to catch immutability issues at compile time? </p>\n<p>There are a couple features in TypeScript that do just that. </p>\n<p>First, we can use the <code>readonly</code> keyword on a field to ensure that it doesn’t change.  And second, we can declare arrays using <code>ReadonlyArray</code>.  For this to be most useful, we are going to want to provide an interface for all of our data that needs to be immutable.  This is how I typically use NgRX.</p>\n<h2 id=\"Enforcing-Functional\"><a href=\"#Enforcing-Functional\" class=\"headerlink\" title=\"Enforcing Functional\"></a>Enforcing Functional</h2><p>Now, that is as far as it goes for support in TypeScript itself, as far as I am aware.  But, we can get more support by using TSLint.  If you are using the Angular-CLI, this gets installed when you create your project.  If you aren’t using the Angular-CLI, or you are using some other framework, you are on your own for getting that installed and setup. </p>\n<p>There are two problems we need to overcome in order to use TSLint to solve our “switch into Functional mode” issue.  First, is that we need a set of rules we can use.  The second is that we will need some way of isolating where those rules take effect. </p>\n<p>Fortunately, we can create a separate <code>tslint.json</code> file for each directory.  And since all of my Functional code is isolated to my NgRX state management stuff, I can put a file in that directory and it will take care of my Functional needs while leaving my normal <code>tslint.json</code> file for the rest of my code. </p>\n<p>The other thing you will want to do is that you’ll want to install <a href=\"//www.npmjs.com/package/tslint-immutable\">tslint-immutable.</a> </p>\n<p>tslint-immutable adds some rules specifically for immutability that are not included in the core implementation.  I love plugable systems. </p>\n<p>I’ll let you read the documentation on the site for the rules that it adds.  Who knows when you’ll be reading this and the package may have changed by the time you get here.</p>\n<h2 id=\"pre-commit-hooks\"><a href=\"#pre-commit-hooks\" class=\"headerlink\" title=\"pre-commit hooks\"></a>pre-commit hooks</h2><p>Having a good set of linting rules if of no use if they get ignored.  Right? </p>\n<p>Now, another package I install into my projects is pre-commit.  Be warned though.  If you are using Windows as your development computer, you’ll also need to install <a href=\"//gnuwin32.sourceforge.net/packages/coreutils.htm\">coreutils</a> because pre-commit assumes you are able to run bash. </p>\n<p>But of course, someone could comment out or remove the pre-commit hooks or otherwise force a commit.  This is why you also want a good code review process in place for your team.  Or better yet, a job that runs on your central repository that verifies that these precommit task have run successfully. </p>\n<p>When I review code, I check several items regularly.</p>\n<ul>\n<li>What changed and was it changed in a way consistent with how we want things coded.</li>\n<li>If something wasn’t coded correctly, is there a linting rule we can put in place to correct it?</li>\n<li>When I pull down the code, can I compile for production as well as for development mode?</li>\n</ul>\n<p>Point 2 is critical.  The more reviewing the computer can do for you the better off you’ll be.</p>\n<h2 id=\"Conditionals\"><a href=\"#Conditionals\" class=\"headerlink\" title=\"Conditionals\"></a>Conditionals</h2><p>What I haven’t been able to find is a rule that will prevent conditions from showing up inside of observable functions or their array cousins.  If you know of something, please let me know in the comments below.</p>\n<h2 id=\"Code\"><a href=\"#Code\" class=\"headerlink\" title=\"Code\"></a>Code</h2><p>Now, a little code would be nice to flesh this all out.  So, this is what I’m currently using: </p>\n<p>First, the scripts and pre-commit sections from my package.json file: </p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">...</span><br><span class=\"line\">  <span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;lint&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ng lint --type-check&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">...</span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;pre-commit&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;lint&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>And then the tslint that I put with my NgRX code: </p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;extends&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;tslint-immutable&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;rulesDirectory&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;../../../node_modules/codelyzer&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;rules&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">/* New rules to enable immutable checks */</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;typedef&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"keyword\">true</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">      <span class=\"string\">&quot;call-signature&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"string\">&quot;arrow-call-signature&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"string\">&quot;parameter&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"string\">&quot;arrow-parameter&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"string\">&quot;property-declaration&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"string\">&quot;variable-declaration&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"string\">&quot;member-variable-declaration&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"string\">&quot;object-destructuring&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"string\">&quot;array-destructuring&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;readonly-keyword&quot;</span><span class=\"punctuation\">:</span> <span class=\"keyword\">false</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;readonly-array&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"keyword\">true</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;ignore-local&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;no-let&quot;</span><span class=\"punctuation\">:</span> <span class=\"keyword\">true</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;no-any&quot;</span><span class=\"punctuation\">:</span> <span class=\"keyword\">true</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"comment\">/* existing rules follow */</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "functional",
                "typescript",
                "tslint"
            ]
        }
    ]
}