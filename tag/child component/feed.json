{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dave's Notebook • All posts by \"child component\" tag",
    "description": null,
    "home_page_url": "http://davembush.github.com",
    "items": [
        {
            "id": "http://davembush.github.com/attaching-an-angular-child-component-s-form-to-a-parent/",
            "url": "http://davembush.github.com/attaching-an-angular-child-component-s-form-to-a-parent/",
            "title": "Attaching an Angular Child Component's Form to a Parent",
            "date_published": "2018-01-02T11:30:57.000Z",
            "content_html": "<p>This past week I implemented a pattern I’ve been pondering for almost a year now.  I like to create rather modular and granular code such that if my data structures are nested, the components that represent them on the screen should be nested as well. The question becomes, how does one create a reactive form in a child component and attach that form to the parent form in a way that:</p>\n<ol>\n<li>Leaves the definition of the child form entirely in the child</li>\n<li>Leaves the processing of the data in the parent where the parent form is the “Smart Component” and the child is a “Dumb Component”</li>\n</ol>\n<p>Most solutions I was able to find attack this problem assuming the child component will be part of an array of controls.  And I suppose, if you wanted to, you could implement that pattern using an array with one element.  But, that just felt like a hack.  If you are interested in that solution, this is the wrong article. <figure><img src=\"/uploads/2018/01/2018-01-02.jpg\" title=\"Attaching an Angular Child Component&#39;s Form to a Parent\"> Photo by <a href=\"//visualhunt.com/author/e29ed9\">loomingy1</a> on <a href=\"//visualhunt.com/re/b9f011\">Visual hunt</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\"> CC BY</a></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"Avoiding-the-Problem\"><a href=\"#Avoiding-the-Problem\" class=\"headerlink\" title=\"Avoiding the Problem\"></a>Avoiding the Problem</h2><p>Up until recently, I’ve been able to avoid this problem entirely by creating separate forms and listening to each individually.  I could have done the same thing here.  But, every time I use this solution, I feel like there must be a better way.  Besides, when you do this correctly, you only need to have one place where you are listening for changes to the form and one place where you send changes into the form.  The work around requires multiples of each.</p>\n<h2 id=\"Basics-of-Nested-Forms\"><a href=\"#Basics-of-Nested-Forms\" class=\"headerlink\" title=\"Basics of Nested Forms\"></a>Basics of Nested Forms</h2><p>Another way of avoiding the problem is to create the form as one monolithic component.  A very simple implementation would be to have a form that looked something like this:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> [<span class=\"attr\">formGroup</span>]=<span class=\"string\">&quot;form&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">formControlName</span>=<span class=\"string\">&quot;mainInput&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">formGroupName</span>=<span class=\"string\">&quot;childGroup&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">formControlName</span>=<span class=\"string\">&quot;childInput&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  &lt;/<span class=\"attr\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>And the reactive definition in the typescript that looked like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppComponent</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">form</span>: <span class=\"title class_\">FormGroup</span>;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">formBuilder: FormBuilder</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">form</span> = formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">mainInput</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">childGroup</span>: formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">childInput</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And then we would grab the data from the valueChanges observable or patch the data into the form using </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">childGroup.<span class=\"property\">childInput</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Creating-the-Child-Component\"><a href=\"#Creating-the-Child-Component\" class=\"headerlink\" title=\"Creating the Child Component\"></a>Creating the Child Component</h2><p>But what if you we want everything in the childGroup to be a control?  That control would look something like this: </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> [<span class=\"attr\">formGroup</span>]=<span class=\"string\">&quot;form&quot;</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">formControlName</span>=<span class=\"string\">&quot;childInput&quot;</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>and then our TypeScript code looks like a normal formGroup:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">form</span> = formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">childInput</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Embedding-the-Child-in-the-Parent\"><a href=\"#Embedding-the-Child-in-the-Parent\" class=\"headerlink\" title=\"Embedding the Child in the Parent\"></a>Embedding the Child in the Parent</h2><p>Now that we have a separate component for our child form, we can use normal directives to add it into our main form.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> [<span class=\"attr\">formGroup</span>]=<span class=\"string\">&quot;form&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">formControlName</span>=<span class=\"string\">&quot;mainInput&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">app-child</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">app-child</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>And our TypeScript code now only needs a reference to mainInput.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">constructor</span>(<span class=\"params\">formBuilder: FormBuilder</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">form</span> = formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">mainInput</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Connecting-the-Child-to-the-Parent\"><a href=\"#Connecting-the-Child-to-the-Parent\" class=\"headerlink\" title=\"Connecting the Child to the Parent\"></a>Connecting the Child to the Parent</h2><p>The problem is, whenever the childInput element changes, the parent form’s valueChanges observer won’t get notified because the parent form no longer knows about the child form.  And this is where things interesting.</p>\n<p>Hooking the child form to the parent form is actually pretty straight forward.  The trick is knowing when in the component life-cycle to run the code.</p>\n<p>The first thing to know is that we aren’t going to be able to hookup the child in the parent until after the child component has been created.  This happens after ngOnInit() so we need to find another lifecycle hook to wire everything up in.  It just so happens that ngAfterViewInit() is the perfect place for this. </p>\n<p>Second, it might be tempting to hookup everything in the child component during it’s ngOnInit() method.  But this would too tightly couple the child component to the parent.  Something we would like to avoid. </p>\n<p>So, the next thing we need to do is that we need to use @ViewChild() to allow the parent to get a hold of the child component, and ultimately the formGroup member variable it will initialize for us.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ViewChild</span>(<span class=\"title class_\">ChildComponent</span>) <span class=\"attr\">childComponent</span>: <span class=\"title class_\">ChildComponent</span>;</span><br></pre></td></tr></table></figure>\n\n<p>And now in <code>ngAfterViewInit()</code> we can add the child’s <code>FormGroup</code> as an additional “control” and set the parent <code>FormGroup</code> to the parent control’s <code>FormGroup</code>.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">ngAfterViewInit</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">form</span>.<span class=\"title function_\">addControl</span>(<span class=\"string\">&#x27;childForm&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">childComponent</span>.<span class=\"property\">form</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">childComponent</span>.<span class=\"property\">form</span>.<span class=\"title function_\">setParent</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">form</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And finally, you’ll want to subscribe to <code>valueChanges</code> and your NgRX <code>Store</code> in <code>ngAfterViewInit()</code> after this wire-up code.</p>\n",
            "tags": [
                "angular",
                "reactive forms",
                "child component"
            ]
        }
    ]
}