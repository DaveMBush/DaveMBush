{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dave's Notebook • All posts by \"testcasedata\" tag",
    "description": null,
    "home_page_url": "http://davembush.github.com",
    "items": [
        {
            "id": "http://davembush.github.com/when-you-really-need-all-of-your-nunit-test-in-one-class/",
            "url": "http://davembush.github.com/when-you-really-need-all-of-your-nunit-test-in-one-class/",
            "title": "When You Really Need All Of Your NUnit Test In One Class",
            "date_published": "2014-03-18T17:16:00.000Z",
            "content_html": "<p><img src=\"/uploads/2014/03/arct-034.jpg\"></p>\n<p>Last week <a href=\"/unit-test-structure/\">I proposed a structure for unit test that follows the pre-condition, action, post-condition workflow</a>.  Basically what you would see in a Use Case document.</p>\n<p>The result of this structure when applied to a general NUnit class is that we will end up with our pre-condition and action in our setup method and our post-condition asserts in our test methods.</p>\n<p>The problem with this is that sometimes this doesn’t always fit what we are trying to do.</p>\n<span id=\"more\"></span>\n\n<p>For example, I’ve been writing selenium test to test web applications I am working on.  Each page I am testing is essentially a form that computes a result at the bottom.  If I were a purest, I would put the page load object and the setup of the state of the page in the setup method.  One for each permutation.  And the assert to verify that it computed correctly.</p>\n<p>In this case, however, I vary slightly because what I really want is all of these similar test together where I can see them.</p>\n<p>But I still keep my code clean by using a TestCaseSource.</p>\n<p>What we are going to do is move just about everything into the TestCaseSource.  The code that is common between each TestCaseSource is going to still go in the SetUp method, but everything else will be declared in the TestCaseSource.</p>\n<p>The basics of how TestCaseSource works is that we setup a Property or a member variable that returns an IEnumerable.  By using the built in TestCaseData class we get a lot of control over what displays.  I’m not going to go over that here.  I’m sure you can <a href=\"//www.nunit.org/index.php?p=testCaseSource&r=2.6.3\">read the documentation</a> as well as I can.</p>\n<p>But what you may not realize when you first look that this documentation is that we can pass in functions and not just objects.  This gives us quite a bit of freedom in what we do here.</p>\n<p>So by setting up our Test method to look like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">Test</span>]</span><br><span class=\"line\">[<span class=\"meta\">TestCaseSource(<span class=\"string\">&quot;DataSource&quot;</span>)</span>]</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Test</span>(<span class=\"params\">Action pre,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    List&lt;Action&gt; actions,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    Action assert</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    pre();</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> action <span class=\"keyword\">in</span> actions) &#123;</span><br><span class=\"line\">        action();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    assert();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>What we are doing is saying that we expect to find a property or member variable called “DataSource” that will pass us a function, a list of functions, and another function.</p>\n<p>The test body runs the first function to do any pre-condition work.  Then it loops through all of the function in the actions list to get the code to the state we need it to be in and then we finally call the assert to test our code.</p>\n<p>Here is a sample of what our DataSource property looks like:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> IEnumerable DataSource</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">get</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Action pre = () =&gt; Console.WriteLine(<span class=\"string\">&quot;given&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> actions = <span class=\"keyword\">new</span> List&lt;Action&gt;</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            () =&gt; Console.WriteLine(<span class=\"string\">&quot;when one&quot;</span>),</span><br><span class=\"line\">            () =&gt; Console.WriteLine(<span class=\"string\">&quot;when two&quot;</span>)</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        Action assert = () =&gt;</span><br><span class=\"line\">            Assert.That(<span class=\"number\">1</span>, Is.EqualTo(<span class=\"number\">1</span>));</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"keyword\">new</span></span></span><br><span class=\"line\"><span class=\"function\">            <span class=\"title\">TestCaseData</span>(<span class=\"params\">pre, actions, assert</span>)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>I’ve broken out the lambda expressions individually so that you can better see what I’m doing.  But in real life, your code will probably look more like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> IEnumerable DataSource</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">get</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title\">TestCaseData</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            (Action</span>)(<span class=\"params\">(</span>)</span> =&gt; Console.WriteLine(<span class=\"string\">&quot;given&quot;</span>)),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> List&lt;Action&gt;</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                () =&gt; Console.WriteLine(<span class=\"string\">&quot;when one&quot;</span>),</span><br><span class=\"line\">                () =&gt; Console.WriteLine(<span class=\"string\">&quot;when two&quot;</span>)</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            (Action)(() =&gt; Assert.That(<span class=\"number\">1</span>, Is.EqualTo(<span class=\"number\">1</span>)))</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You will need the (Action) cast to make the compiler understand what you are trying to do.  It isn’t smart enough to know that a lambda express is an Action which is a delegate that take no parameters and returns void.</p>\n<p>When you run the code, above, we get this output:</p>\n<p><img src=\"/uploads/2014/03/GivenWhenThenTest.png\" alt=\"GivenWhenThenTest\" title=\"GivenWhenThenTest\"></p>\n<p>By chaining on the SetName() call, you can make each iteration show up as it’s own unique test so you can see what is occuring in your test runner.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> IEnumerable DataSource</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">get</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">yield</span> <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title\">TestCaseData</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            (Action</span>)(<span class=\"params\">(</span>)</span> =&gt; Console.WriteLine(<span class=\"string\">&quot;given&quot;</span>)),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> List&lt;Action&gt;</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                () =&gt; Console.WriteLine(<span class=\"string\">&quot;when one&quot;</span>),</span><br><span class=\"line\">                () =&gt; Console.WriteLine(<span class=\"string\">&quot;when two&quot;</span>)</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            (Action)(() =&gt; Assert.That(<span class=\"number\">1</span>, Is.EqualTo(<span class=\"number\">1</span>)))</span><br><span class=\"line\">        ).SetName(<span class=\"string\">&quot;First Test&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And this looks like this in the test runner:</p>\n<p><img src=\"/uploads/2014/03/GivenWhenThen2.png\" alt=\"GivenWhenThen2\" title=\"GivenWhenThen2\"></p>\n<p>Once again, I have to reiterate, this is not something I would do a lot of, but it is a pretty neat trick when you need it. </p>\n",
            "tags": [
                "tdd",
                "test driven development",
                "nunit",
                "testcasedata",
                "testcasesource"
            ]
        }
    ]
}