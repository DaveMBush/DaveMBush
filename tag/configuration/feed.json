{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dave's Notebook • All posts by \"configuration\" tag",
    "description": null,
    "home_page_url": "http://davembush.github.com",
    "items": [
        {
            "id": "http://davembush.github.com/where-to-store-angular-configurations/",
            "url": "http://davembush.github.com/where-to-store-angular-configurations/",
            "title": "Where To Store Angular Configurations",
            "date_published": "2018-08-11T10:59:34.000Z",
            "content_html": "<p>Because this is a frequent problem, because it is so often done incorrectly and because there is a great alternative, today I want to discuss where to store Angular configurations. You know, all that information that changes as you move from your local development environment to the Development, QA and Production servers?</p>\n<p>There’s a place for that!</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Wrong-Place\"><a href=\"#Wrong-Place\" class=\"headerlink\" title=\"Wrong Place\"></a>Wrong Place</h2><p>I know it is tempting, but the environment.ts and environment.prod.ts files were never meant for configuration information other than to tell the run-time you are running a production version of the code instead of developing the code locally. Yes, I know it is possible to create a file for your different environments and you can effectively use the file for your configuration information. But, just because you can, doesn’t mean you should.</p>\n<p>In an ideal world, you would build a release candidate and place it on your Development server and then move it from there to QA and then to Production. You would never rebuild the application. You want to be absolutely sure that the code you tested in the Development environment is the code you ran in the QA environment and that the code you ran in the QA environment is the code that is running in the Production environment. You want to know for sure that the only possible reason why something isn’t working is because the configuration information is incorrect.</p>\n<p>There are other ways to mitigate the risk, but they all involve recompiling the code and tagging your repository so you can get the same code back. This works when there isn’t a better way. But, there is a better way!</p>\n<h2 id=\"Where-Instead\"><a href=\"#Where-Instead\" class=\"headerlink\" title=\"Where Instead?\"></a>Where Instead?</h2><p>If we can’t put our configuration information in our code, where do we put it? Obviously external to your code. This leaves us several solutions. One is to create a static json file that gets copied into your dist directory when the code is deployed to each environment. Another place that I’ve see work is to place the code in a database. The advantage to the database method is that you can have one database that handles the configuration information for all of your applications and even all of your environments. Put a good administration GUI on top of it and you can change the configuration easily without having to deploy even a file.</p>\n<h2 id=\"Jumping-The-Hurdle\"><a href=\"#Jumping-The-Hurdle\" class=\"headerlink\" title=\"Jumping The Hurdle\"></a>Jumping The Hurdle</h2><p>Now that you’ve put your configuration information in an external location, you realize that you’ll need to make a GET request to retrieve that information. You may also quickly realize that you need that configuration information as soon as your application starts up. Maybe putting that information in an external file wasn’t such a great idea after all?</p>\n<p>Well, not so fast!</p>\n<p>There is a little known API feature in Angular that lets us load stuff up front and will actually wait until the loading has completed before continuing on with our code.</p>\n<h2 id=\"APP-INITIALIZER\"><a href=\"#APP-INITIALIZER\" class=\"headerlink\" title=\"APP_INITIALIZER\"></a>APP_INITIALIZER</h2><p>APP_INITIALIZER is a multi provider type that lets you specify a factory that returns a promise. When the promise completes, the application will continue on. So when you get to the place in your code where you need the configuration information, you can be sure it has been loaded. It’s pretty slick.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"variable constant_\">APP_INITIALIZER</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">    ....</span><br><span class=\"line\">    <span class=\"attr\">providers</span>: [</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">provide</span>: <span class=\"variable constant_\">APP_INITIALIZER</span>,</span><br><span class=\"line\">            <span class=\"attr\">useFactory</span>: load,</span><br><span class=\"line\">            <span class=\"attr\">multi</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>where <code>load</code> is a <code>function</code> that returns a <code>function</code> that returns a <code>Promise&lt;boolean&gt;</code>. The promise function loads your configuration information and stores it in your application.  Once your configuration has been loaded, you resolve the promise using <code>resolve(true)</code>.</p>\n<p>This last point is really important.  If you get this wrong, the code won’t wait for this to finish loading before moving on.  <code>useFactory</code> points to a <code>function</code> that returns a <code>function</code> that returns a <code>Promise&lt;boolean&gt;</code>!</p>\n<p>The <code>multi: true</code> thing is because APP_INITIALIZER allows multiple instances of this provider. They all run simultaneously, but the code will not continue beyond APP_INTITIALIZER until all of the Promises have resolved.</p>\n<h2 id=\"An-example\"><a href=\"#An-example\" class=\"headerlink\" title=\"An example.\"></a>An example.</h2><p>Now, as a discussion point, let’s assume that you have a regular Angular CLI based project and you need to load in the base location of your REST endpoints.  You might have a config.json file that looks something like this:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;baseUrl&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;https://davembush.github.io/api&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>You would create a different one of these for each of the environments you wanted to deploy to, and, as part of your deployment process, you would copy the appropriate file to <code>config.json</code> in the same location that you deploy all of your Angular CLI generated static files.</p>\n<h3 id=\"Basic-App-Initializer\"><a href=\"#Basic-App-Initializer\" class=\"headerlink\" title=\"Basic App Initializer\"></a>Basic App Initializer</h3><p>Now, the thing we want to do is to load this config file at runtime using APP_INITIALIZER.  To do that, let’s add an APP_INITIALIZER provider to our app.module.ts file.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"variable constant_\">APP_INITIALIZER</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">BrowserModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">NgModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">AppComponent</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./app.component&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">declarations</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">AppComponent</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">BrowserModule</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">providers</span>: [&#123;</span><br><span class=\"line\">    <span class=\"attr\">provide</span>: <span class=\"variable constant_\">APP_INITIALIZER</span>,</span><br><span class=\"line\">    <span class=\"attr\">useFactory</span>: load,</span><br><span class=\"line\">    <span class=\"attr\">multi</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;],</span><br><span class=\"line\">  <span class=\"attr\">bootstrap</span>: [<span class=\"title class_\">AppComponent</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure>\n\n<p>For now, you’ll notice, we are ignoring the implementation of the <code>load()</code> function.  Typically, I add load to another file and import it, but for the purposes of explaining how this works, we will leave it as part of this code.</p>\n<h3 id=\"Type-the-load-function\"><a href=\"#Type-the-load-function\" class=\"headerlink\" title=\"Type the load() function\"></a>Type the load() function</h3><p>Since I made such a big deal about the typing of the load function, we should type the load function to make sure it actually returns what we have in mind. The following is skeleton code that we will embellish.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\"></span>): (<span class=\"function\">() =&gt;</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;((<span class=\"attr\">resolve</span>: <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">boolean</span></span>) =&gt;</span> <span class=\"built_in\">void</span>): <span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>At this point, the code doesn’t do anthing useful, but you should be able to compile and run the code at this point without seeing any errors in the console.</p>\n<h3 id=\"Proof-that-it-waits\"><a href=\"#Proof-that-it-waits\" class=\"headerlink\" title=\"Proof that it waits\"></a>Proof that it waits</h3><p>Next, we want to prove that this really is stopping the rest of our code from running.  To do this, we are going to use a simple <code>setTimeout()</code> to simulate a long running process that we need to wait on to complete.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\"></span>): (<span class=\"function\">() =&gt;</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;((<span class=\"attr\">resolve</span>: <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">boolean</span></span>) =&gt;</span> <span class=\"built_in\">void</span>): <span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>), <span class=\"number\">10000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>This code waits for 10 seconds before resolving.  You can play with the timeout value to prove to yourself that this code really is waiting.</p>\n<h3 id=\"The-fun-begins\"><a href=\"#The-fun-begins\" class=\"headerlink\" title=\"The fun begins\"></a>The fun begins</h3><p>Now, the purpose of this code is to load the config.json file.  For that we are going to need to get access to the HttpClient service. Normally, we use dependency injection to access this, and this code is no different.</p>\n<p>Back in the provider, add a <code>deps: []</code> section.  To inject HttpClient, use:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deps</span>: [<span class=\"title class_\">HttpClient</span>]</span><br></pre></td></tr></table></figure>\n\n<p>And change the load function to take HttpClient as a parameter.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\">http: HttpClient</span>): (<span class=\"function\">() =&gt;</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;((<span class=\"attr\">resolve</span>: <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">boolean</span></span>) =&gt;</span> <span class=\"built_in\">void</span>): <span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>), <span class=\"number\">10000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Don’t forget to import <code>HttpClientModule</code> into your module.</p>\n<p>And, once we load the configuration file, we will want to save the information some place.  There are a couple of ways that you might do this, but the most Angular like would be to create a service.  In our case our service will have one field named <code>baseUrl</code>.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Injectable</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Injectable</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">providedIn</span>: <span class=\"string\">&#x27;root&#x27;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ConfigService</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">baseUrl</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"></span>) &#123; &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Since our service is using the new <code>provideIn</code> flag, we don’t need to worry about adding it to a module.</p>\n<p>In order to set this, we will need to add ConfigService to the <code>deps:</code> array.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deps</span>: [</span><br><span class=\"line\">  <span class=\"title class_\">HttpClient</span>,</span><br><span class=\"line\">  <span class=\"title class_\">ConfigService</span></span><br><span class=\"line\">],</span><br></pre></td></tr></table></figure>\n\n<p>And make it a parameter of our <code>load()</code> function.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\">http: HttpClient, config: ConfigService</span>): (<span class=\"function\">() =&gt;</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;((<span class=\"attr\">resolve</span>: <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">boolean</span></span>) =&gt;</span> <span class=\"built_in\">void</span>): <span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>), <span class=\"number\">10000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Loading-config-json\"><a href=\"#Loading-config-json\" class=\"headerlink\" title=\"Loading config.json\"></a>Loading config.json</h3><p>The rest is pretty straight forward Angular code.  We will</p>\n<ul>\n<li>http.get(‘.config.json’)</li>\n<li>if it gives us a 404 error, we set default values</li>\n<li>if it succeeds we set the values from the data that got loaded.</li>\n</ul>\n<p>Now, why would we get a 404 error?</p>\n<p>Well, the one place where this file won’t be available is when we are using <code>ng serve</code> during development.  But when we load this with a regular server like Apache, IIS, or Nginx, the file will be available.</p>\n<p>Now, where we have the <code>setTimeout()</code> code, replace it with <code>http.get()</code> code.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;./config.json&#x27;</span>)</span><br><span class=\"line\"> .<span class=\"title function_\">pipe</span>(</span><br><span class=\"line\">   <span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">x: ConfigService</span>) =&gt;</span> &#123;</span><br><span class=\"line\">     config.<span class=\"property\">baseUrl</span> = x.<span class=\"property\">baseUrl</span>;</span><br><span class=\"line\">     <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">   &#125;),</span><br><span class=\"line\">   <span class=\"title function_\">catchError</span>((<span class=\"attr\">x</span>: &#123; <span class=\"attr\">status</span>: <span class=\"built_in\">number</span> &#125;, <span class=\"attr\">caught</span>: <span class=\"title class_\">Observable</span>&lt;<span class=\"built_in\">void</span>&gt;): <span class=\"title class_\">ObservableInput</span>&lt;&#123;&#125;&gt; =&gt; &#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (x.<span class=\"property\">status</span> !== <span class=\"number\">404</span>) &#123;</span><br><span class=\"line\">       <span class=\"title function_\">resolve</span>(<span class=\"literal\">false</span>);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     config.<span class=\"property\">baseUrl</span> = <span class=\"string\">&#x27;http://localhost:8080/api&#x27;</span>;</span><br><span class=\"line\">     <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"title function_\">of</span>(&#123;&#125;);</span><br><span class=\"line\">   &#125;)</span><br><span class=\"line\"> ).<span class=\"title function_\">subscribe</span>();</span><br></pre></td></tr></table></figure>\n\n<p>I’m not going to bother explaining all of the details of RxJS 6, you can look that all up if you are interested.</p>\n<h2 id=\"Caveats\"><a href=\"#Caveats\" class=\"headerlink\" title=\"Caveats\"></a>Caveats</h2><p>Regardless of which of the two methods you use, you’ll need to make sure that your code will not need to change to access the database or the config file. If you are going to use a database, even then, I would not hard-code anything other than a relative URL. If the database is on some external server, make sure that you can proxy the code to is from your application’s server so that if and when the database location changes, you won’t need to recompile your code.</p>\n<h2 id=\"Full-resulting-code\"><a href=\"#Full-resulting-code\" class=\"headerlink\" title=\"Full resulting code\"></a>Full resulting code</h2><p>Just in case I left out a step or you are otherwise lost or maybe all you really care about is the code so you can copy and paste it.</p>\n<p>Here it is:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"variable constant_\">APP_INITIALIZER</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">BrowserModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">NgModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">HttpClientModule</span>, <span class=\"title class_\">HttpClient</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/common/http&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">AppComponent</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./app.component&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">ConfigService</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./config.service&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"keyword\">of</span>, <span class=\"title class_\">Observable</span>, <span class=\"title class_\">ObservableInput</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;../../node_modules/rxjs&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; map, catchError &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;rxjs/operators&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\">http: HttpClient, config: ConfigService</span>): (<span class=\"function\">() =&gt;</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;((<span class=\"attr\">resolve</span>: <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">boolean</span></span>) =&gt;</span> <span class=\"built_in\">void</span>): <span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;</span><br><span class=\"line\">       http.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;./config.json&#x27;</span>)</span><br><span class=\"line\">         .<span class=\"title function_\">pipe</span>(</span><br><span class=\"line\">           <span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">x: ConfigService</span>) =&gt;</span> &#123;</span><br><span class=\"line\">             config.<span class=\"property\">baseUrl</span> = x.<span class=\"property\">baseUrl</span>;</span><br><span class=\"line\">             <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">           &#125;),</span><br><span class=\"line\">           <span class=\"title function_\">catchError</span>((<span class=\"attr\">x</span>: &#123; <span class=\"attr\">status</span>: <span class=\"built_in\">number</span> &#125;, <span class=\"attr\">caught</span>: <span class=\"title class_\">Observable</span>&lt;<span class=\"built_in\">void</span>&gt;): <span class=\"title class_\">ObservableInput</span>&lt;&#123;&#125;&gt; =&gt; &#123;</span><br><span class=\"line\">             <span class=\"keyword\">if</span> (x.<span class=\"property\">status</span> !== <span class=\"number\">404</span>) &#123;</span><br><span class=\"line\">               <span class=\"title function_\">resolve</span>(<span class=\"literal\">false</span>);</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">             config.<span class=\"property\">baseUrl</span> = <span class=\"string\">&#x27;http://localhost:8080/api&#x27;</span>;</span><br><span class=\"line\">             <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">             <span class=\"keyword\">return</span> <span class=\"title function_\">of</span>(&#123;&#125;);</span><br><span class=\"line\">           &#125;)</span><br><span class=\"line\">         ).<span class=\"title function_\">subscribe</span>();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">declarations</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">AppComponent</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">BrowserModule</span>,</span><br><span class=\"line\">    <span class=\"title class_\">HttpClientModule</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">providers</span>: [&#123;</span><br><span class=\"line\">      <span class=\"attr\">provide</span>: <span class=\"variable constant_\">APP_INITIALIZER</span>,</span><br><span class=\"line\">      <span class=\"attr\">useFactory</span>: load,</span><br><span class=\"line\">      <span class=\"attr\">deps</span>: [</span><br><span class=\"line\">        <span class=\"title class_\">HttpClient</span>,</span><br><span class=\"line\">        <span class=\"title class_\">ConfigService</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">multi</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">bootstrap</span>: [<span class=\"title class_\">AppComponent</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "angular",
                "configuration",
                "devops"
            ]
        }
    ]
}