{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dave's Notebook • All posts by \"serialization\" tag",
    "description": null,
    "home_page_url": "http://davembush.github.com",
    "items": [
        {
            "id": "http://davembush.github.com/serializable-attribute-vs-serializable-interface/",
            "url": "http://davembush.github.com/serializable-attribute-vs-serializable-interface/",
            "title": "Serializable attribute vs Serializable Interface",
            "date_published": "2008-04-09T11:11:33.000Z",
            "content_html": "<p>Judging from the comments I received yesterday, it looks like we need to review  serialization in .NET.</p>\n<h2 id=\"The-Easy-Way\"><a href=\"#The-Easy-Way\" class=\"headerlink\" title=\"The Easy Way\"></a>The Easy Way</h2><p>There are two ways of making an object serializable.  The first, and easiest way is by applying the Serializable attribute to the class.  Once you’ve done this all of the member variables in the class will get stored into the stream unless you’ve attributed one of the variables with NonSerialized.</p>\n<p>This method is useful for objects you want to be able to store temporarily.  For example, you might use this to transfer objects using Web Services or if you wanted to store the object in a session variable when your sessions are being stored in a session server.  You would never use this to store the object to a file that you want to be able to retrieve some time in the future after restarting your application.  That is, you would never use this method to implement the <a href=\"/2008/04/08/unauthorizedaccessexception-writing-to-hklm/\">Registry solution</a> I mentioned yesterday.</p>\n<h2 id=\"The-Reliable-Way\"><a href=\"#The-Reliable-Way\" class=\"headerlink\" title=\"The Reliable Way\"></a>The Reliable Way</h2><p>What you need instead is the Serializable Interface, or more correctly, you want to implement ISerializable on your class.  Using the ISerializable interface gives you a lot more control.  Used correctly, you can store an object to a file system, shut down your application, install an upgrade to the application with additional information (or less information) in the class, and still successfully load the object from the file system.  So, let’s illustrate with a simple class:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">int</span> m_intVar;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Demo</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"The-Basics\"><a href=\"#The-Basics\" class=\"headerlink\" title=\"The Basics\"></a>The Basics</h2><p>This is a pretty simple class.  It has one member variable that we will use to save some sort of state information and will need to get stored to the stream when we save the object instance.  To implement the interface, we need to change the class to look like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">Serializable</span>]</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> : <span class=\"title\">ISerializable</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">int</span> m_intVar;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Demo</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Demo</span>(<span class=\"params\">SerializationInfo info, StreamingContext context</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        m_intVar = info.GetInt32(<span class=\"string\">&quot;m_intVar&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">GetObjectData</span>(<span class=\"params\">SerializationInfo info,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        StreamingContext context</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        info.AddValue(<span class=\"string\">&quot;m_intVar&quot;</span>, m_intVar);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>The thing to watch out for here is that you need a constructor that takes SerializationInfo and StreamingContext as parameters.  Since the interface can’t remember this, you’ll have to remember it.</p>\n<p>You’ll notice that we’ve taken control of storing and retrieving the data by using the AddValue and GetInt32 calls inside of the new, required, constructor and the GetObjectData method.  GetObjectData is called when the data is being saved.  The constructor gets called when the data is being loaded.</p>\n<h2 id=\"Protecting-For-The-Future\"><a href=\"#Protecting-For-The-Future\" class=\"headerlink\" title=\"Protecting For The Future\"></a>Protecting For The Future</h2><p>If we leave the code as it is above, we are no better off than if we had simply implemented the Serializable attribute.  What we need to add to this code is some way of versioning the object.  This is easy to do by adding a few more lines of code: When we initially create the object, all we need to do is add one line of code to our GetObjectData method</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">GetObjectData</span>(<span class=\"params\">SerializationInfo info,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    StreamingContext context</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    info.AddValue(<span class=\"string\">&quot;VERSION&quot;</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    info.AddValue(<span class=\"string\">&quot;m_intVar&quot;</span>, m_intVar);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"The-Future\"><a href=\"#The-Future\" class=\"headerlink\" title=\"The Future\"></a>The Future</h2><p>Some time later, we decide to add another variable to our class:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"built_in\">int</span> m_intVar;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"built_in\">string</span> m_stringVar;</span><br></pre></td></tr></table></figure>\n\n<p>And save it as part of GetObjectData.  Because we’ve added another variable, we need to increment the version number.  So, GetObjectData now looks like:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">GetObjectData</span>(<span class=\"params\">SerializationInfo info, StreamingContext context</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    info.AddValue(<span class=\"string\">&quot;VERSION&quot;</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">    info.AddValue(<span class=\"string\">&quot;m_intVar&quot;</span>, m_intVar);</span><br><span class=\"line\">    info.AddValue(<span class=\"string\">&quot;m_stringVar&quot;</span>, m_stringVar);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>and our constructor now looks like:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Demo</span>(<span class=\"params\">SerializationInfo info, StreamingContext context</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">int</span> VERSION = info.GetInt32(<span class=\"string\">&quot;VERSION&quot;</span>);</span><br><span class=\"line\">    m_intVar = info.GetInt32(<span class=\"string\">&quot;m_intVar&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (VERSION &gt; <span class=\"number\">1</span>)</span><br><span class=\"line\">        m_stringVar = info.GetString(<span class=\"string\">&quot;m_stringVar&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> m_stringVar = <span class=\"string\">&quot;default string&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>By incrementing the version number every time we make a change to the class and testing for the appropriate version number when we load the object, we can avoid having our application crash simply because the class has changed between the time we save the object and the time we loaded the object from the stream.</p>\n",
            "tags": [
                "c#",
                "serialization"
            ]
        }
    ]
}