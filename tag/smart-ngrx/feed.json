{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dave's Notebook • All posts by \"smart-ngrx\" tag",
    "description": null,
    "home_page_url": "http://davembush.github.com",
    "items": [
        {
            "id": "http://davembush.github.com/what-i-learned-writing-smartngrx/",
            "url": "http://davembush.github.com/what-i-learned-writing-smartngrx/",
            "title": "What I Learned Writing SmartNgRX",
            "date_published": "2024-10-14T11:12:03.000Z",
            "content_html": "<p>Last week, I announced a project I had been working on for over 10 months. I call it <a href=\"/smart-ngrx/\">SmartNgRX</a> and it solves many common issues most of us have using SmartNgRX, including the boilerplate issue, over-fetching, and memory pressure caused by stale data.</p>\n<p>Today I want to talk about a few things I learned while creating SmartNgRX that can be applied globally to any project.</p>\n<span id=\"more\"></span>\n\n<h2 id=\"No-Boilerplate-Needed\"><a href=\"#No-Boilerplate-Needed\" class=\"headerlink\" title=\"No Boilerplate Needed\"></a>No Boilerplate Needed</h2><p>While SmartNgRX solves the boilerplate issue, you can apply this to your code simply by making all your NgRX slices behave the same. Once you’ve done that, you can create a single factory function for each of your Actions, Reducers, and Effects and use that to generate the Actions, Reducers, and Effects you need.</p>\n<p>You can see how I’ve done this by looking at the source code for SmartNgRX.</p>\n<h3 id=\"Generic-Actions\"><a href=\"#Generic-Actions\" class=\"headerlink\" title=\"Generic Actions\"></a>Generic Actions</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> actionGroupCache = <span class=\"keyword\">new</span> <span class=\"title class_\">Map</span>&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">unknown</span>&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> actionFactory&lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">SmartNgRXRowBase</span>&gt;(</span><br><span class=\"line\">  <span class=\"attr\">feature</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">  <span class=\"attr\">entity</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">): <span class=\"title class_\">ActionGroup</span>&lt;T&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> source = <span class=\"string\">`<span class=\"subst\">$&#123;feature&#125;</span><span class=\"subst\">$&#123;psi&#125;</span><span class=\"subst\">$&#123;entity&#125;</span>`</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> cached = actionGroupCache.<span class=\"title function_\">get</span>(source) <span class=\"keyword\">as</span> <span class=\"title class_\">ActionGroup</span>&lt;T&gt; | <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (cached) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cached;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> actionGroup = <span class=\"title function_\">createActionGroup</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">source</span>: source <span class=\"keyword\">as</span> <span class=\"built_in\">any</span>,</span><br><span class=\"line\">    <span class=\"attr\">events</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;Update Many&#x27;</span>: props&lt;<span class=\"title class_\">UpdateChanges</span>&lt;T&gt;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Remove</span>: props&lt;<span class=\"title class_\">IdsProp</span>&gt;(),</span><br><span class=\"line\">      <span class=\"string\">&#x27;Load By Ids&#x27;</span>: props&lt;<span class=\"title class_\">IdsProp</span>&gt;(),</span><br><span class=\"line\">      <span class=\"string\">&#x27;Load By Ids Preload&#x27;</span>: props&lt;<span class=\"title class_\">IdsProp</span>&gt;(),</span><br><span class=\"line\">      <span class=\"string\">&#x27;Store Rows&#x27;</span>: props&lt;<span class=\"title class_\">RowsProp</span>&lt;T&gt;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Update</span>: props&lt;&#123; <span class=\"attr\">old</span>: <span class=\"title class_\">RowProp</span>&lt;T&gt;; <span class=\"attr\">new</span>: <span class=\"title class_\">RowProp</span>&lt;T&gt; &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"string\">&#x27;Add To Store&#x27;</span>: props&lt;<span class=\"title class_\">RowProp</span>&lt;T&gt;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Add</span>: props&lt;&#123;</span><br><span class=\"line\">        <span class=\"attr\">row</span>: T;</span><br><span class=\"line\">        <span class=\"attr\">parentId</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">        <span class=\"attr\">parentFeature</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">        <span class=\"attr\">parentEntityName</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">      &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"string\">&#x27;Add Success&#x27;</span>: props&lt;&#123;</span><br><span class=\"line\">        <span class=\"attr\">newRow</span>: T;</span><br><span class=\"line\">        <span class=\"attr\">oldRow</span>: T;</span><br><span class=\"line\">        <span class=\"attr\">parentId</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">        <span class=\"attr\">parentFeature</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">        <span class=\"attr\">parentEntityName</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">      &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Delete</span>: props&lt;&#123;</span><br><span class=\"line\">        <span class=\"attr\">id</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">        <span class=\"attr\">parentInfo</span>: &#123; <span class=\"attr\">feature</span>: <span class=\"built_in\">string</span>; <span class=\"attr\">entity</span>: <span class=\"built_in\">string</span>; <span class=\"attr\">ids</span>: <span class=\"built_in\">string</span>[] &#125;[];</span><br><span class=\"line\">      &#125;&gt;(),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  actionGroupCache.<span class=\"title function_\">set</span>(source, actionGroup);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> actionGroup;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>A casual glance will show you that all I’ve done is wrap the <code>createActionGroup</code> function from NgRX with a function that takes a feature and entity name and returns an ActionGroup. This is a simple example of reducing boilerplate in your code. We use the feature name and the entity name to generate the source name for the ActionGroup which makes it unique.</p>\n<p>You’ll notice that I’ve also cached the <code>ActionGroup</code> so that if you call it again, you’ll get the same <code>ActionGroup</code> back. This simple optimization allows you to use the factory function to retrieve the action wherever you need it instead of passing it around. In my case, I needed this because the library doesn’t expose the actions used by NgRX and I wanted to let the developers using SmartNgRX use the actions in their code if they desired.</p>\n<h3 id=\"Reducers\"><a href=\"#Reducers\" class=\"headerlink\" title=\"Reducers\"></a>Reducers</h3><p>Similarly, I’ve wrapped <code>createReducer</code> with a factory function that takes the feature and entity name and returns a reducer. Again, this is all you need to ensure the reducer is unique.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> reducerFactory&lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">SmartNgRXRowBase</span>&gt;(</span><br><span class=\"line\">  <span class=\"attr\">feature</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">  <span class=\"attr\">entity</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">): <span class=\"title class_\">ActionReducer</span>&lt;<span class=\"title class_\">EntityState</span>&lt;T&gt;&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> adapter = entityDefinitionCache&lt;T&gt;(feature, entity).<span class=\"property\">entityAdapter</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> initialState = adapter.<span class=\"title function_\">getInitialState</span>();</span><br><span class=\"line\">  <span class=\"keyword\">const</span> actions = actionFactory&lt;T&gt;(feature, entity);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title function_\">createReducer</span>(</span><br><span class=\"line\">    initialState,</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">add</span>, <span class=\"function\">(<span class=\"params\">state, &#123; row &#125;</span>) =&gt;</span> adapter.<span class=\"title function_\">upsertOne</span>(row, state)),</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">addSuccess</span>, <span class=\"function\">(<span class=\"params\">state, &#123; newRow &#125;</span>) =&gt;</span></span><br><span class=\"line\">      adapter.<span class=\"title function_\">upsertOne</span>(newRow, state),</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">updateMany</span>, <span class=\"function\">(<span class=\"params\">state, &#123; changes &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> adapter.<span class=\"title function_\">updateMany</span>(changes, state);</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">remove</span>, <span class=\"function\">(<span class=\"params\">state, &#123; ids &#125;</span>) =&gt;</span> adapter.<span class=\"title function_\">removeMany</span>(ids, state)),</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">update</span>, <span class=\"function\">(<span class=\"params\">state, &#123; <span class=\"keyword\">new</span>: &#123; row &#125; &#125;</span>) =&gt;</span></span><br><span class=\"line\">      adapter.<span class=\"title function_\">upsertOne</span>(row, state),</span><br><span class=\"line\">    ),</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">storeRows</span>, <span class=\"function\">(<span class=\"params\">state, &#123; rows &#125;</span>) =&gt;</span> adapter.<span class=\"title function_\">upsertMany</span>(rows, state)),</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Effects\"><a href=\"#Effects\" class=\"headerlink\" title=\"Effects\"></a>Effects</h3><p>Finally, I’ve wrapped <code>createEffect</code> with a factory function that takes the feature and entity name and returns an effect. This is the same as the other two examples.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> effectsFactory&lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">SmartNgRXRowBase</span>&gt;(</span><br><span class=\"line\">  <span class=\"attr\">feature</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">  <span class=\"attr\">entityName</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">  <span class=\"attr\">effectsServiceToken</span>: <span class=\"title class_\">InjectionToken</span>&lt;<span class=\"title class_\">EffectService</span>&lt;T&gt;&gt;,</span><br><span class=\"line\">): <span class=\"title class_\">Record</span>&lt;<span class=\"title class_\">EffectsFactoryKeys</span>, <span class=\"title class_\">FunctionalEffect</span>&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> actions = actionFactory&lt;T&gt;(feature, entityName);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> entityDefinition = entityDefinitionCache&lt;T&gt;(feature, entityName);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> adapter = entityDefinition.<span class=\"property\">entityAdapter</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Ends up calling the `EffectService` to delete the row specified</span></span><br><span class=\"line\"><span class=\"comment\">     * by the ID in the action.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">delete</span>: <span class=\"title function_\">createEffect</span>(</span><br><span class=\"line\">      <span class=\"title function_\">deleteEffect</span>(effectsServiceToken, actions),</span><br><span class=\"line\">      dispatchFalse,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Ends up calling the `EffectService` to determine what rows</span></span><br><span class=\"line\"><span class=\"comment\">     * need to be loaded yet and returns dummy rows for those rows.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">loadByIdsPreload</span>: <span class=\"title function_\">createEffect</span>(</span><br><span class=\"line\">      <span class=\"title function_\">loadByIdsPreloadEffect</span>(feature, entityName, actions),</span><br><span class=\"line\">      dispatchFalse,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Ends up calling the `EffectService` to load the rows specified</span></span><br><span class=\"line\"><span class=\"comment\">     * from the server.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">loadByIds</span>: <span class=\"title function_\">createEffect</span>(</span><br><span class=\"line\">      <span class=\"title function_\">loadByIdsEffect</span>(effectsServiceToken, actions, feature, entityName),</span><br><span class=\"line\">      dispatchFalse,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Ends up calling the `EffectService` to update the row specified</span></span><br><span class=\"line\"><span class=\"comment\">     * by the row in the action.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">update</span>: <span class=\"title function_\">createEffect</span>(</span><br><span class=\"line\">      updateEffect&lt;T&gt;(effectsServiceToken, actions, feature, entityName),</span><br><span class=\"line\">      dispatchFalse,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Ends up calling the `EffectService` to add the row specified</span></span><br><span class=\"line\"><span class=\"comment\">     * by the row in the action.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">add</span>: <span class=\"title function_\">createEffect</span>(<span class=\"title function_\">addEffect</span>(effectsServiceToken, actions), dispatchTrue),</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Handles adding the new row to the store and removing the dummy row</span></span><br><span class=\"line\"><span class=\"comment\">     * that was added so we could edit it.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">addSuccess</span>: <span class=\"title function_\">createEffect</span>(</span><br><span class=\"line\">      addSuccessEffect&lt;T&gt;(effectsServiceToken, actions, adapter),</span><br><span class=\"line\">      dispatchFalse,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>By now, you get the general idea. A couple of things to note about the <code>effectsFactory</code>.</p>\n<p>First we pass in an <code>InjectionToken</code> that is used to get the <code>EffectService</code> that is used by the effects. By doing this, all we need to do is make sure your effects services conform to the <code>EffectService</code> abstract class and we can use them in the effects.</p>\n<p>This is how SmartNgRX can hide NgRX from the developer and just let them implement the specifics for each entity.</p>\n<p>You’ll also notice that to keep the code clean, I’ve implemented the details in other functions that I call. If you want to see the details, you can <a href=\"https://github.com/DaveMBush/SmartNgRX/tree/cbec5143855b1916e0c67776b22a6134a18d5ee4/libs/smart-ngrx/src/effects\">look at the source code for the effects in SmartNgRX</a>.</p>\n<p>Second, we use the cached <code>ActionGroup</code> by calling the <code>actionFactory</code> function to get the actions we need for the effects instance. Now we don’t need to know about a specific instance and find some way to pass it into the effect.</p>\n<p>Finally, we need access to the EntityAdapter for the entity we are working with. We create the entity adapter when we configure SmartNgRX. The two lines of code, above, that retrieve the adapter are retrieving it from a map where we set it during SmartNgRX setup</p>\n<p>And that’s how you avoid NgRX boilerplate in your code.</p>\n<h2 id=\"Too-Many-Actions-and-Reducers\"><a href=\"#Too-Many-Actions-and-Reducers\" class=\"headerlink\" title=\"Too Many Actions and Reducers\"></a>Too Many Actions and Reducers</h2><p>I’ve been saying this for several years and still managed to get this “wrong” while writing my code.</p>\n<p>Here’s the basic issue. Reducers and Effects have specific purposes. Where I went wrong is with my reducers. But I’ll address both Reducers and Effects here.</p>\n<p>But first, let’s take a detour and talk about an ideal NgRX setup.</p>\n<h3 id=\"Ideal-NgRX-Setup\"><a href=\"#Ideal-NgRX-Setup\" class=\"headerlink\" title=\"Ideal NgRX Setup\"></a>Ideal NgRX Setup</h3><p>The Redux pattern, generally, and NgRX, specifically, were created to store states predictably. “State only” is my motto. This means that logic should be kept out of our NgRX code. This keeps our NgRX code simple and reduces bugs. You wouldn’t believe some of the code I’ve seen that violates this principle. Then again, maybe you could. You’ve probably written it.</p>\n<p>So, if we want to keep logic out of NgRX, where should it go?</p>\n<h3 id=\"Action-Services\"><a href=\"#Action-Services\" class=\"headerlink\" title=\"Action Services\"></a>Action Services</h3><p>It goes in a service. When you call an action, it should already have the data in the form that NgRX ultimately needs. The reducer can then take this data and store it in the store without doing anything to it.</p>\n<p>Notice how small my reducer code is.</p>\n<h3 id=\"Effects-Service\"><a href=\"#Effects-Service\" class=\"headerlink\" title=\"Effects Service\"></a>Effects Service</h3><p>Similarly, when you call an effect, it should already have the data to do whatever it needs. Again, in an ideal world, all the effect does is call what I’ve come to term the effect service. The effect service can do whatever work needs to be done.</p>\n<p>For example, say you are calling the server, but the shape of the data you get back isn’t what your application will need. The place to do the transformation is in the effect service. Not in the effect.</p>\n<p>By doing this, you’ll only need actions that perform basic CRUD operations. You shouldn’t see actions for every possible way you could change the state of your application. Most of that can, and should, be handled in an Action Service.</p>\n<p>There has been a lot of noise in the community about using the “facade” pattern with NgRX but most implementations I’ve seen just put a class in front of the same actions we’ve always had. This is not a facade pattern. This is just a bulky, excessive layer in front of what we’ve always been doing.</p>\n<p>What I’m doing is closer to a facade pattern because now all those action calls become calls to a service. The service does the transformations and dispatches whatever action is appropriate to update the store.</p>\n<h3 id=\"Command-or-Event-Pattern\"><a href=\"#Command-or-Event-Pattern\" class=\"headerlink\" title=\"Command or Event Pattern\"></a>Command or Event Pattern</h3><p>By following these tip, the question of using the command or event patterns with NgRX becomes moot. The argument for using the event pattern is that your actions now give you some idea of what triggered them by using the action name as the where. In the pattern I’ve described, 100% of your actions (should) get triggered by the same code every time if you’ve structured things correctly.  That code gets triggered by multiple other places just like any other function in your code does. Now, you can evaluate the call stack. You can still use the event pattern. But, there isn’t a strong argument for it anymore.</p>\n<p>The best part about using this pattern is that I’m in a great position to convert SmartNgRX to use Signals instead of Observables and most of my code won’t change.</p>\n<p>As far as NgRX code is concerned, the only NgRX place you should have any logic at all is in Selectors, but that’s a topic for another day.</p>\n",
            "tags": [
                "angular",
                "ngrx",
                "smart-ngrx"
            ]
        }
    ]
}