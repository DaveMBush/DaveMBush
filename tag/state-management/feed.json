{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dave's Notebook • All posts by \"state-management\" tag",
    "description": null,
    "home_page_url": "http://davembush.github.com",
    "items": [
        {
            "id": "http://davembush.github.com/avoiding-ngrx-boilerplate/",
            "url": "http://davembush.github.com/avoiding-ngrx-boilerplate/",
            "title": "Avoiding NgRx Boilerplate",
            "date_published": "2022-11-19T17:17:54.000Z",
            "content_html": "<p>One of the recurring complaints I hear about NgRX is that it requires too much boiler plate code. But, it doesn’t have to be this way. In fact, I’ve been working on a project that has a lot of NgRX code and I’ve been able to reduce the amount of boilerplate code to a minimum and gain features in the process.</p>\n<span id=\"more\"></span>\n\n<p>If you look at your NgRX code you should find that your actions, reducers, and effects are all very similar. If you don’t find this to be true in your own code, you should consider this a code smell. While how we each use NgRX may vary from project to project, within a project there should be enough consistency that you can reduce the boiler plate code you write and just supply the differences rather than repeating yourself over and over again.</p>\n<h2 id=\"NgRX-Entities\"><a href=\"#NgRX-Entities\" class=\"headerlink\" title=\"NgRX Entities\"></a>NgRX Entities</h2><p>One reason you may find your code does not lend itself to common actions, reducers, and effects is because you have not yet discovered NgRX Entities. NgRX Entities are an “Optional” NgRX add-on that allow you to reduce quite a bit of redundant code, especially in the Reducers where you can just make a call to an Adapter function to do all the work for you. The end result is that your store is an array of IDs and an object of type <code>Record&lt;string, T&gt;</code> where <code>T</code> describes the shape of your record and <code>string</code> is the ID of the record. Using this pattern it is very easy to find a record by the ID so we can easily join to slices of our store together using a selector.</p>\n<p>The remainder of this article assumes you are familiar with NgRX Entities and how to use them. If you are not, I recommend you read the <a href=\"https://ngrx.io/guide/entity\">NgRX Entity Documentation</a> and then come back to this article.</p>\n<h2 id=\"Actions\"><a href=\"#Actions\" class=\"headerlink\" title=\"Actions\"></a>Actions</h2><p>The first, very obvious place we find boiler plate code in NgRX is with actions. The more recent release of NgRX already makes creating actions relatively easy by providing the <code>createActionGroup</code> function. This function allows you to create a group of actions with a single function call. However, it still requires you to provide the action type and the action payload. This is where we can start to reduce the boiler plate code.</p>\n<p>Let’s say, for a start, that all your actions look something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> entityActions = <span class=\"title function_\">createActionGroup</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">source</span>: <span class=\"string\">&#x27;Entity Name Here&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">events</span>:&#123;</span><br><span class=\"line\">    <span class=\"title class_\">Load</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: <span class=\"title class_\">Entity</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAll</span>: props&lt;&#123; <span class=\"attr\">ids</span>: <span class=\"built_in\">string</span>[] &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAllSuccess</span>: props&lt;&#123; <span class=\"attr\">entities</span>: <span class=\"title class_\">Entity</span>[] &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAllFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Create</span>: props&lt;&#123; <span class=\"attr\">entity</span>: <span class=\"title class_\">Entity</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">CreateSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: <span class=\"title class_\">Entity</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">CreateFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Update</span>: props&lt;&#123; <span class=\"attr\">entity</span>: <span class=\"title class_\">Entity</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">UpdateSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: <span class=\"title class_\">Entity</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">UpdateFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Delete</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">DeleteSuccess</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">DeleteFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Even if you create some generator to create this code for you, it is still quite a bit of code that needs to be compiled and shipped to the browser.</p>\n<p>What if, instead, all we had to do was write this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> entityActions = <span class=\"title function_\">createActionGroup</span>(</span><br><span class=\"line\">  <span class=\"string\">&#x27;Entity Name Here&#x27;</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>All you need to do, for this to work, is create a new <code>createActionGroup</code> function that returns the NgRX version of the same method with everything filled out.</p>\n<p>Well, “all you have to do” is a bit of an exaggeration as there are some typing issues you’ll need to address.</p>\n<p>Here is the code:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createActionGroup <span class=\"keyword\">as</span> ngrxCreateActionGroup, props &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@ngrx/store&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">NgrxActionGroup</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./types/ngrx-action-group.type&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * StringLiteralCheck was copied from NgRX because it is hidden.  It forces</span></span><br><span class=\"line\"><span class=\"comment\"> * the source parameter to be a string literal.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">StringLiteralCheck</span>&lt;</span><br><span class=\"line\">  <span class=\"title class_\">Str</span> <span class=\"keyword\">extends</span> <span class=\"built_in\">string</span>,</span><br><span class=\"line\">  <span class=\"title class_\">Name</span> <span class=\"keyword\">extends</span> <span class=\"built_in\">string</span></span><br><span class=\"line\">&gt; = <span class=\"built_in\">string</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Str</span> ? <span class=\"string\">`<span class=\"subst\">$&#123;Name&#125;</span> must be a string literal type`</span> : <span class=\"built_in\">unknown</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">StringLiteralSource</span>&lt;<span class=\"title class_\">Source</span> <span class=\"keyword\">extends</span> <span class=\"built_in\">string</span>&gt; = <span class=\"title class_\">Source</span> &amp;</span><br><span class=\"line\">  <span class=\"title class_\">StringLiteralCheck</span>&lt;<span class=\"title class_\">Source</span>, <span class=\"string\">&#x27;source&#x27;</span>&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * createActionGroup creates all the actions an entity will need reducing quite a bit</span></span><br><span class=\"line\"><span class=\"comment\"> * of boilerplate code.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * The `source` parameter is the same as the `source` parameter in NgRX&#x27;s createActionGroup.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> createActionGroup = &lt;<span class=\"title class_\">Source</span> <span class=\"keyword\">extends</span> <span class=\"built_in\">string</span>, T&gt;(</span><br><span class=\"line\">  <span class=\"attr\">source</span>: <span class=\"title class_\">StringLiteralSource</span>&lt;<span class=\"title class_\">Source</span>&gt;</span><br><span class=\"line\">): <span class=\"title class_\">NgrxActionGroup</span>&lt;T&gt; =&gt;</span><br><span class=\"line\">  <span class=\"title function_\">ngrxCreateActionGroup</span>(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// because ngrxCreateActionGroup expects a string literal</span></span><br><span class=\"line\">    <span class=\"comment\">// we have to cast as any to get around the type check</span></span><br><span class=\"line\">    <span class=\"comment\">// this is why we made sure our source parameter does the</span></span><br><span class=\"line\">    <span class=\"comment\">// string literal check.</span></span><br><span class=\"line\">    <span class=\"attr\">source</span>: source <span class=\"keyword\">as</span> <span class=\"built_in\">any</span>,</span><br><span class=\"line\">    <span class=\"attr\">events</span>: &#123;</span><br><span class=\"line\">      <span class=\"title class_\">Load</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">LoadSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">LoadFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">LoadAll</span>: props&lt;&#123; <span class=\"attr\">ids</span>: <span class=\"built_in\">string</span>[] &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">LoadAllSuccess</span>: props&lt;&#123; <span class=\"attr\">entities</span>: T[] &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">LoadAllFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Create</span>: props&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">CreateSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">CreateFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Update</span>: props&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">UpdateSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">UpdateFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Delete</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">DeleteSuccess</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">DeleteFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>You’ll notice that I’ve added a new type <code>NgrxActionGroup</code> as the return value. This ensures that the return value is strongly typed to the information provided.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">type</span> <span class=\"title class_\">NgrxActionGroup</span>&lt;T&gt; = <span class=\"title class_\">ActionGroup</span>&lt;</span><br><span class=\"line\">  <span class=\"comment\">// using any here is the only way I could get this to work</span></span><br><span class=\"line\">  <span class=\"comment\">// without worse hacks or rewriting createActionGroup</span></span><br><span class=\"line\">  <span class=\"built_in\">any</span>,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Load</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadSuccess</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadFailure</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAll</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">ids</span>: <span class=\"built_in\">string</span>[] &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAllSuccess</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entities</span>: T[] &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAllFailure</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Create</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">CreateSuccess</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">CreateFailure</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Update</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">UpdateSuccess</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">UpdateFailure</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Delete</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">DeleteSuccess</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">DeleteFailure</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&gt;;</span><br></pre></td></tr></table></figure>\n\n<p>Most of the work in getting that all working correctly was with the strong typing. You may need to tweak for your purposes, but this is the basic idea.</p>\n<p>If you need to add actions that are unique to a particular entity, you can use the <code>createActionGroup</code> function from NgRX and then return the combined actions using the spread operator.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> entityActions = &#123;</span><br><span class=\"line\">  ...<span class=\"title function_\">createActionGroup</span>(<span class=\"string\">&#x27;Entity Name Here&#x27;</span>),</span><br><span class=\"line\">  ...<span class=\"title function_\">ngrxCreateActionGroup</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">source</span>: <span class=\"string\">&#x27;Entity Name Here&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">events</span>: &#123;</span><br><span class=\"line\">      <span class=\"title class_\">UniqueAction</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Reducers\"><a href=\"#Reducers\" class=\"headerlink\" title=\"Reducers\"></a>Reducers</h2><p>Reducers are very similar. Once again, NgRX already gives us a way of creating a Reducer function with one call.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> entityReducer = <span class=\"title function_\">createReducer</span>(</span><br><span class=\"line\">  initialState,</span><br><span class=\"line\">  <span class=\"title function_\">on</span>(entityActions.<span class=\"property\">Load</span>, <span class=\"function\">(<span class=\"params\">state, &#123; id &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      ...state,</span><br><span class=\"line\">      <span class=\"attr\">loading</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"comment\">// etc...</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>But if the on() code is the same, why repeat it over and over?  Just create a new factory function that specifies what is unique and let it do the rest of the work.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> createReducer = &lt;T, N <span class=\"keyword\">extends</span> <span class=\"built_in\">string</span>&gt;(</span><br><span class=\"line\">  <span class=\"attr\">adapter</span>: <span class=\"title class_\">EntityAdapter</span>&lt;T&gt;, <span class=\"comment\">// EntityAdapter is an NgRX Entities type</span></span><br><span class=\"line\">  <span class=\"attr\">entityName</span>: N,</span><br><span class=\"line\">  <span class=\"attr\">actions</span>: <span class=\"title class_\">NgrxActionGroup</span>&lt;T&gt;</span><br><span class=\"line\">): <span class=\"title class_\">ActionReducer</span>&lt;<span class=\"title class_\">EntityState</span>&lt;T&gt;&gt; =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title function_\">ngrxCreateReducer</span>(</span><br><span class=\"line\">    adapter.<span class=\"title function_\">getInitialState</span>(),</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">load</span>, <span class=\"function\">(<span class=\"params\">state, &#123; id &#125;</span>) =&gt;</span></span><br><span class=\"line\">      adapter.<span class=\"title function_\">upsertOne</span>(id, state)</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"comment\">// etc...</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>And now, you can create all your reducers using your new createReducer function.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> entityReducer = <span class=\"title function_\">createReducer</span>(</span><br><span class=\"line\">  entityAdapter,</span><br><span class=\"line\">  <span class=\"string\">&#x27;Entity Name Here&#x27;</span>,</span><br><span class=\"line\">  entityActions</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Effects\"><a href=\"#Effects\" class=\"headerlink\" title=\"Effects\"></a>Effects</h2><p>Effects are a little more complicated. The basic idea is that you want to create an generic class with abstract methods it can use to pull in what is different from the class that implements it. To be honest, there is still quite a bit of code you have to write but there are two advantages. Since you are only providing the differences, there is much less code to write and because it is the same code being used everywhere, once you get it working, it works everywhere, reducing the chance of errors.</p>\n<p>Because your code is probably going to look much different than the code I’m using, I’m going to provide samples of the code rather than the full blown implementation.</p>\n<p>This also takes advantage of the new createEffect() function in NgRX 8.0.0.</p>\n<p>Our generic class is going to look something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SmartEffects</span>&lt;T&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * actions is the action group for this entity</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">get</span> <span class=\"title function_\">actions</span>(): <span class=\"title class_\">NgrxActionGroup</span>&lt;T&gt;;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * adapter is the entity adapter for this entity</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">get</span> <span class=\"title function_\">adapter</span>(): <span class=\"title class_\">EntityAdapter</span>&lt;T&gt;;</span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * updateOperator is the method that will run when the update</span></span><br><span class=\"line\"><span class=\"comment\">   *   action is dispatched.  You would create a similar operator</span></span><br><span class=\"line\"><span class=\"comment\">   *   method for any other calls you&#x27;d make to the server or other</span></span><br><span class=\"line\"><span class=\"comment\">   *   insertion points you would need for an effect</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> <span class=\"variable\">action</span></span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"title function_\">updateOperator</span>(</span><br><span class=\"line\">    <span class=\"comment\">// have to use any here because that is how NgRX defines it</span></span><br><span class=\"line\">    <span class=\"attr\">action</span>: &#123;<span class=\"attr\">row</span>: T&#125; &amp; <span class=\"title class_\">TypedAction</span>&lt;<span class=\"string\">`[<span class=\"subst\">$&#123;<span class=\"built_in\">any</span>&#125;</span>] Update`</span>&gt;</span><br><span class=\"line\">  ): <span class=\"title class_\">Observable</span>&lt;T&gt;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You might thing you could use an abstract field instead of  an abstract getter. But, javascript initializes the parent class prior to the child class and the field you need won’t be available when the effects are created.</p>\n<p>You’ll need to make the calls to the createEffect() methods inside the constructor. Again, the order that code gets executed between parent classes and child classes forces this to be done in the constructor.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>Once you’ve created a consistent way of using NgRX throughout your code, you not only reduce the amount of boiler plate code you have to write, but you also reduce errors, make your code more maintainable, and create consistency throughout your code which will make it significantly more understandable.</p>\n",
            "tags": [
                "angular",
                "ngrx",
                "state-management"
            ]
        },
        {
            "id": "http://davembush.github.com/clean-state-management-with-ngrx/",
            "url": "http://davembush.github.com/clean-state-management-with-ngrx/",
            "title": "Clean State Management with NgRx",
            "date_published": "2022-07-04T16:46:07.000Z",
            "content_html": "<p>Once again I’ve run into a situation where the code I’m looking at doesn’t resemble how the code was meant to be written.</p>\n<p>I’ve spent the last month fixing bugs that can all be summarized by the following problems:</p>\n<ul>\n<li>Reducers updating nested data.</li>\n<li>Storing data manipulations that Selectors could perform</li>\n<li>Using Effects as Selectors</li>\n<li>Components doing too much data manipulation</li>\n<li>Too many actions and indirection</li>\n</ul>\n<span id=\"more\"></span>\n\n<p>Unfortunately, the people who need to hear this the most are the ones who will never read this article. Some of what I’m about to say, I may have discovered over the last several years of programming but I’m sure I didn’t discover this in isolation.</p>\n<p>So, lets review how NgRX should be used effectively.</p>\n<h2 id=\"The-Problem-with-Nested-Data\"><a href=\"#The-Problem-with-Nested-Data\" class=\"headerlink\" title=\"The Problem with Nested Data\"></a>The Problem with Nested Data</h2><p>If you’ve ever worked on a system with nested state data as part of one slice, you know that updating that nested data is a pain. For those of you who haven’t, having to update that data makes your reducer 10 times longer and 3 times more complicated than it needs to be.</p>\n<p>This means, first, you’ve written more code than you need. This means there is a higher possibility of errors.  But beyond that, the code your customer has to download is also larger than it needs to be.  Worse, because it runs every time the nested data is updated, the code performs slower than it needs to.</p>\n<p>That last point might surprise you. Why does it run slower? Simply because you may end up running that code when it was not necessary.</p>\n<h2 id=\"The-Problem-with-Storing-State-the-Way-You-Want-to-Use-It\"><a href=\"#The-Problem-with-Storing-State-the-Way-You-Want-to-Use-It\" class=\"headerlink\" title=\"The Problem with Storing State the Way You Want to Use It\"></a>The Problem with Storing State the Way You Want to Use It</h2><p>Related to nested data is the urge to store state the way you want to use it later on in the application.</p>\n<p>The main problem with doing this is that you need to make sure that state gets updated correctly from every place you update the raw data. In the process, you will invariably run the the derived state code multiple times when you could have only run it once or in many cases, not at all.</p>\n<p>Instead, you should modify the data into something your presentation needs using Selectors. Since everyone should be using the Selectors to get the information they need, and that selector is looking at the raw data, you can be sure that everyone is getting the correct data. Also, if nothing is listening to the observable that the selector returns, you will not be running the selector code more times than is necessary.</p>\n<p>You also have the advantage of taking advantage of memoization so that this data manipulation only happens when the data is needed and when it changes.</p>\n<h2 id=\"Storing-State\"><a href=\"#Storing-State\" class=\"headerlink\" title=\"Storing State\"></a>Storing State</h2><p>Rule number one of state management is to store state at the most granular level you can. This means, in part, that each slice of your state, the table in your store, should be flat.</p>\n<p>What does it mean that the data is flat? It means that the object only contains primitive values. Strings, number, booleans, dates, or collections of objects that only contain primitive values. Just like you would in a relational database table.</p>\n<p>But, this may not be the most granular level.</p>\n<p>Say you have a row in your database that contains 3 fields that you always want but 50 or so that you only want if a particular presentation is running.  I would recommend creating a slice for the 3 main fields and then another slice or more, for the remaining fields and allow for the fact that you may not have all of them all the time.</p>\n<p>While most systems don’t need this. The system I’m working on does.</p>\n<p>This solves the storing nested data issue.</p>\n<h2 id=\"The-Job-of-Effects\"><a href=\"#The-Job-of-Effects\" class=\"headerlink\" title=\"The Job of Effects\"></a>The Job of Effects</h2><p>Apparently, some people think that the job of an effect is to manipulate data.  But as we’ve already established, manipulating data is the job of selectors. No, the job of Effects is to retrieve data from wherever we are persisting it and to update the persistent store with any changes we’ve made. If we need to manipulate data to do either of those, again, Selectors is where we would do this work.</p>\n<p>Once you’ve narrowed the job of your effects down to this, you no longer need to return multiple actions from an effect.  Ideally an effect should fire one action.  But, no more than two.</p>\n<h2 id=\"The-Job-of-Reducers\"><a href=\"#The-Job-of-Reducers\" class=\"headerlink\" title=\"The Job of Reducers\"></a>The Job of Reducers</h2><p>Reducers only have three jobs: add new data to the slice, remove data from the slice, and update data in the slice. That’s it. If your reducers are doing more than that, you’re doing it wrong.</p>\n<h2 id=\"Extra-Credit\"><a href=\"#Extra-Credit\" class=\"headerlink\" title=\"Extra Credit\"></a>Extra Credit</h2><p>The above, is the bare minimum and may server you well for small projects. However, for larger projects you will want to consider using NgRX Entities.  This will reduce the amount of boiler plate code you need to write as well as making it easy to join your slices however you need to.</p>\n<p>One place in the code I’m working on this would be particularly useful is to see what slice owns another slice.  As the data is stored and returned we only know who the children are most of the time.  To find the parent, we have to iterate through the data to find the child and then look at what parent we are in.</p>\n<p>It gets even more complicated when a row of data could have more than one parent.</p>\n<h2 id=\"Thinking-About-Code\"><a href=\"#Thinking-About-Code\" class=\"headerlink\" title=\"Thinking About Code\"></a>Thinking About Code</h2><p>The last point I want to make regarding state management is that how we think about our code impacts how we write our code.</p>\n<p>I’ve discovered over the years that most of us think about code from a GUI perspective. But, by doing this, we also tend to put a lot of logic in our components and keep doing so, until that doesn’t work any more. At that point, we start to consider state management.</p>\n<p>But what if we thought about code strictly from a data perspective? If every time you thought about the code you were writing and though, “what if I didn’t have a presentation layer? What problem am I trying to solve really? How can I do this without a presentation layer?” Then, your code would be more flexible, easier to maintain, and more scalable.</p>\n<p>How would it be more flexible?</p>\n<p>Back as the dotCom days were starting I had a manager come to me with a VB6 😝 application he had had build and said, “I’d like to take this code and run it on the web, or from a phone, or from the desktop.”  And my response to him was, “You can’t get their from here.” because the code was so tightly coupled to the presentation layer.</p>\n<p>But to bring it today, we often have the same kind of requirements. We originally solve a problem only to have our managers come to us with a new requirement that suggest using the same data to look at the code in a different way.  If all your data logic is in the presentation layer, you might achieve the goal but you’ll also have a lot of duplicate code if you are very careful. But, lets say you manage to pull that off. Six months later you are working on a bug in one of those two views. You fix it, but you forget about that other view and never think to fix it there too. And this is where your troubles begin.</p>\n<p>By pushing code as far down the stack as is practical, you reduce the amount of code you write, reduce the size of the code that your customer has to download, reduce the code you have to maintain, and in the case of NgRX end up writing code that performs faster.</p>\n<p>So, how might you force yourself to think in this way? By following this simple rule: Presentational components should only 1) display the data they’ve been give or 2) fire events indicating that some action has taken place.</p>\n<p>There is another type of component generally referred to as “Smart” components. They too have a rule. They should only 1) retrieve data from the store via Selectors and 2) fire actions to update the Store or trigger an Effect.</p>\n<h2 id=\"Storing-Ancillary-State\"><a href=\"#Storing-Ancillary-State\" class=\"headerlink\" title=\"Storing Ancillary State\"></a>Storing Ancillary State</h2><p>Thinking about your code this way leads to the last point I want to make. If your data is always your single source of truth, you’ll want to store information in the Store that will help you determine things like sort order and filtering as well as other information that may be in your form.</p>\n<p>Personally, I tend to store all my form data in my store beyond, and including, the data I need to send back to the server. This helps me derive the data for my presentation layer and allows my actions to have smaller payloads.</p>\n<p>Many of you send all your form data with your action to update the database because you still think of the update as something the presentation layer is doing. The way I work with data is I just send an action that notifies the store that I want to update the data with the data from my form. The Effect grabs that data from the store and sends it to the server.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>While I’ve centered the discussion above to NgRX. The main ideas port to other methods of state management including things like Redux, MobX, and even Apollo GraphQL.</p>\n<p>By following the above architecture and design patterns your code will be easier to maintain, have fewer bugs and scale better.</p>\n",
            "tags": [
                "angular",
                "ngrx",
                "state-management"
            ]
        }
    ]
}