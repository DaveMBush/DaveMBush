{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dave's Notebook • All posts by \"asp.net\" category",
    "description": null,
    "home_page_url": "http://davembush.github.com",
    "items": [
        {
            "id": "http://davembush.github.com/what%E2%80%99s-the-truth-about-running-asp-net-webapi-asynchronously/",
            "url": "http://davembush.github.com/what%E2%80%99s-the-truth-about-running-asp-net-webapi-asynchronously/",
            "title": "What’s the Truth about Running ASP.NET WEBAPI Asynchronously?",
            "date_published": "2016-11-15T12:30:00.000Z",
            "content_html": "<p>When Node.JS started getting popular, one of the major benefits people were proclaiming about it is that the web servers running under Node.JS were all processing the request asynchronously. This is how a single threaded environment was able to handle a significant load without falling over. Cool! So, you might wonder how does ASP.NET process request? It processes code synchronously. So, one might assume that if there were a way of running code asynchronously, we might be able to improve the performance of our applications. But can we? And if we can, is it worth it?</p>\n<figure>![](/uploads/2016/11/image-2.png \"What’s the Truth about Running ASP.NET WEBAPI Asynchronously?\") Photo via [VisualHunt](//visualhunt.com/)</figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"Background\"><a href=\"#Background\" class=\"headerlink\" title=\"Background\"></a>Background</h2><p>The general idea of an asynchronous request is that a thread handles the incoming requests and immediately fires up another thread to handle the request. When the processing thread is done, it calls a callback function to notify the request thread that it is ready to send data back to the client. Meanwhile, the request thread has been able to handle additional request from additional clients. In contrast, a synchronous request processes the request itself so it is unable to handle any additional request.</p>\n<p>In Node.JS, this is important because there is only one thread. It handles all of the request. If we had blocked, there would be no way of processing additional incoming request.</p>\n<p>In ASP.NET, we are running in a system that can run multiple thread per process. So, we are able to handle multiple request because each thread is handled by a different thread. The problem, however, is that there are a limited number of threads that we can spawn per process and eventually we are handling so much traffic that we can’t handle any more. The longer our request take to respond, the more likely we are to experience this problem.</p>\n<p>Imagine the kind of through put we could get on an ASP.NET application if we could make it run asynchronously, more like how Node.JS does.</p>\n<h2 id=\"So-What’s-the-Problem\"><a href=\"#So-What’s-the-Problem\" class=\"headerlink\" title=\"So What’s the Problem?\"></a>So What’s the Problem?</h2><p>So, all of this sounds really good. But then when I went to try to find out how it works, I stumbled on a Stack Overflow question that basically indicated that it shouldn’t work. This, along with a project I was working on, lead me down the road of testing it for myself. Lesson: “Just because someone says something is true, doesn’t mean it is!”</p>\n<h2 id=\"The-Test\"><a href=\"#The-Test\" class=\"headerlink\" title=\"The Test\"></a>The Test</h2><h3 id=\"Tools\"><a href=\"#Tools\" class=\"headerlink\" title=\"Tools\"></a>Tools</h3><p><strong>WestWind Web Surge (WWWS)</strong> <a href=\"//websurge.west-wind.com/\">http://websurge.west-wind.com/</a> Simple load testing tool.</p>\n<p>Add a URL, set number of threads to run concurrently, run, check report.</p>\n<p>There is a command line version you can use as well.</p>\n<p><strong>Strathweb.CacheOutput</strong> There is a version for WEB API v1 and v2.</p>\n<p>This allows us to add server and client side caching information to REST end points.</p>\n<p><strong>Web Server</strong> I’m using the web server built into Visual Studio 2015. I’m assuming IIS performs similarly.</p>\n<p>All the tests were run on an 8 core computer with 16 gig of RAM. The numbers are for relative comparison. Your tests may show slightly different results.</p>\n<h3 id=\"Baseline\"><a href=\"#Baseline\" class=\"headerlink\" title=\"Baseline\"></a>Baseline</h3><p>For a baseline, I ran WWWS against this end point:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> IEnumerable&lt;<span class=\"built_in\">string</span>&gt; <span class=\"title\">Get</span>()</span> &#123;</span><br><span class=\"line\">    System.Threading.Thread.Sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">string</span>[] &#123; <span class=\"string\">&quot;value1&quot;</span>, <span class=\"string\">&quot;value2&quot;</span> &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Notice that while I am returning static information, I am simulating processing time with the Sleep() method. This makes it look like it took a minute to process the information prior to returning the information from the server.</p>\n<p>I was able to run WWWS against the end-point for 20 seconds at a rate of 100 threads at a time without any errors. However, I was only able to achieve 28 request per second with an average response time of 4 seconds. Pretty slow once you see the optimizations.</p>\n<h3 id=\"Asynchronous-Optimization\"><a href=\"#Asynchronous-Optimization\" class=\"headerlink\" title=\"Asynchronous Optimization\"></a>Asynchronous Optimization</h3><p>The next test was to see what performance improvements I could get by running the end-point asynchronously.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">async</span> Task&lt;IEnumerable&lt;<span class=\"built_in\">string</span>&gt;&gt; Get()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> Task.Delay(<span class=\"number\">1000</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">string</span>[] &#123; <span class=\"string\">&quot;value1&quot;</span>, <span class=\"string\">&quot;value2&quot;</span> &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Note: you cannot just add the <code>async</code> keyword to the method, you must also have code you are <code>await</code>-ing inside your method. Otherwise the code will fall back to the baseline code. This is why I replaced Sleep() with Task.Delay(). It gives me something to await, while still waiting for a second prior to returning from the request.</p>\n<p>Keeping all the parameters the same and running this code, request per second improved to 97. Average response time was just over 1 second.</p>\n<p>I wasn’t able to get any failures within 20 seconds until I set simultaneous threads to 2000. At 1900 simultaneous threads the average response time was 9 seconds and the request processed per second was 444.</p>\n<p>So while the response time was longer, more items were able to be processed by simply making the call asynchronous. So, that seems to prove that making the request asynchronous improves the performance.</p>\n<h2 id=\"Even-Better-Performance\"><a href=\"#Even-Better-Performance\" class=\"headerlink\" title=\"Even Better Performance\"></a>Even Better Performance</h2><p>But wait! There’s more.</p>\n<p>What would it be like if we added caching onto this? By using the <code>CacheOutput</code> mechanism, we gain further benefit. While it might be difficult to add this in every situation, at least for static output this is something to be considered. I used the Strathweb implementation because it most closely implemented what had previously been available for WebForms and it now available in .NET Core The code</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">CacheOutput(ClientTimeSpan = 50000,ServerTimeSpan = 50000)</span>]</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">async</span> Task&lt;IEnumerable&lt;<span class=\"built_in\">string</span>&gt;&gt; Get()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> Task.Delay(<span class=\"number\">1000</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">string</span>[] &#123; <span class=\"string\">&quot;value1&quot;</span>, <span class=\"string\">&quot;value2&quot;</span> &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>While WWWS doesn’t allow us to test client caching, it does allow us to test server caching.</p>\n<p>In the code above I set the cache time to 50 seconds. Using the same 1900 threads as before, the average response time was 6 seconds with an average request processed per second of 347. I gave up maxing out the system at 3200 threads. This was returning results on average after 10 seconds of the request with request processed per second of 344.</p>\n<p>If you were able to implement smart caching so new data was returned from the server only when something had actually changed, I’m sure you could achieve similar results with data that changed more frequently than your basic lookup tables.</p>\n",
            "tags": [
                "asp.net",
                "async",
                "await",
                "webapi"
            ]
        },
        {
            "id": "http://davembush.github.com/converting-a-datalist-to-a-listview/",
            "url": "http://davembush.github.com/converting-a-datalist-to-a-listview/",
            "title": "Converting a DataList to a ListView",
            "date_published": "2013-12-26T01:15:26.000Z",
            "content_html": "<p>Yesterday, I spent the bulk of the day converting a DataList to a ListView.  I thought I’d spend a little time relating the process for those of you who might be interested in doing the same.</p>\n<span id=\"more\"></span>\n\n<p>For the most part, the transition went smoothly.</p>\n<p>The first thing I looked at was the structure of the two sets of tags.  It was pretty quickly apparent that I was not going to be able to just change the tag name.  Not that I expected I could, but it would have been a nice bonus. </p>\n<p>What I did notice as I inspected the structure was that both sets have an ItemTemplate tag.  So I create a new ListView control pointing at the data I want it to display, and then I moved the itemTemplate tag from the DataList into the new ListView.</p>\n<p>Bad move.  But, since I’ve already suffered the pain, it won’t be so bad for you.  The basic problem stems from the fact that the ListView itemTemplate expects to start and end with a pair of TD tags.  In the DataList’s itemTemplate tag, you can put anything you want.  So, what you should do is copy the contents of the itemTemplate tag in the DataList into the the ListView’s itemTemplate tag and then put the TD tags around the content you just pasted, and inside the itemTemplate tags.</p>\n<p>Not so bad once you figure it out, but if you start this process after a full day of programming, this can be just a bit frustrating.</p>\n",
            "tags": [
                "asp.net",
                "datalist",
                "listview"
            ]
        },
        {
            "id": "http://davembush.github.com/webservices-%E2%80%93-error-handling/",
            "url": "http://davembush.github.com/webservices-%E2%80%93-error-handling/",
            "title": "WebServices – Error Handling",
            "date_published": "2013-12-12T00:20:26.000Z",
            "content_html": "<p><img src=\"/uploads/2009/06/tp-vol2-004.jpg\" alt=\"tp_vol2_004\" title=\"tp_vol2_004\"> Several weeks ago I presented jQuery at the DotNet User’s Group in Connecticut.  As part of that presentation, I mentioned that I handle errors from my WebServices in a slightly different way than what most authors teach.</p>\n<span id=\"more\"></span>\n\n<p>As I mentioned in the presentation, I do not make use of the SoapException stuff that is part of the SOAP standard for WebServices.  This is because rolling my own SOAP Exception is a lot of work for not a whole lot of pay back and it doesn’t give me the information I’m really looking for when an exception occurs on the server side.  I also don’t let .NET wrap the exception for me because by the time the error gets back to the client, it has even less information than if I had rolled my own.</p>\n<p>This is not to say that you shouldn’t handle the SOAP Exception on the client side.  There are several reasons why a SOAP Exception might be thrown that have nothing to do with what happened inside the method, but once I’ve successfully made a call into my method, I’m going to handle the exceptions that happen inside the method with my own exception handlers and reporting.</p>\n<p>All I do is simply create a structure that has two elements in it.  The data I want to return from the web service and a variable I name “err” that is a string that holds the error message from the exception that was thrown.  So if my web service returned an Integer, my structure would look something like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">struct</span> RetValue &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">int</span> <span class=\"keyword\">value</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> err;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>and then I would use it in my code like this</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">WebMethod</span>]</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> RetValue <span class=\"title\">Add</span>(<span class=\"params\"><span class=\"built_in\">int</span> a, <span class=\"built_in\">int</span> b</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    RetValue r;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        r.<span class=\"keyword\">value</span> =  a + b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">        r.err = e.Message;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> r;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Obviously, for a real production system, you’d do more with the error handling.  This is just a demo.</p>\n<p>You might also consider adding the callstack to the structure and returning that so that you can tell where the error came from.  You might do that only in debug mode and leave the err for release mode.</p>\n<p>I’ve been using this method for years.  It might not be the “sanctioned” way of handling errors, but I think it is a lot easier to deal with.</p>\n",
            "tags": [
                "exceptions",
                "asmx",
                "error handling",
                "webservice"
            ]
        },
        {
            "id": "http://davembush.github.com/tracking-down-performance-issues-in-asp-net/",
            "url": "http://davembush.github.com/tracking-down-performance-issues-in-asp-net/",
            "title": "Tracking Down Performance Issues in ASP.NET",
            "date_published": "2013-07-24T10:36:13.000Z",
            "content_html": "<p>Last night, one of my clients assigned me a problem that I thought was going to require one solution, and in the end it was just poor programming. But the process reminded me of the need for good debugging skills. Just how do you know where the performance problem is? Too many programmers I know approach performance issues from the front end. “I know there is going to be a performance problem if I do it this way, so I’m going to do it that way instead.” But unless your theory was correct, you are very likely to spend extra time doing something you may not need to do. While solving problems is what makes programming fun for a lot of us, solving problems that don’t exist is a waste of time for the organizations we work for. My motto is:</p>\n<span id=\"more\"></span>\n\n<ul>\n<li>Get the app working</li>\n<li>Get the app working right</li>\n<li>Get the app working fast</li>\n</ul>\n<p>By following these steps, in this order, I very rarely even need to address step three. So, what happens when there is a performance problem? How do you track it down? Well, hopefully, you are addressing a visible performance problem. Something is taking more than a second to run. There are cases where you need to address performance problems that are less than a second and&#x2F;or can’t really be measured with a stop watch. But the biggest hits are the easiest to solve. So all you need to do is set some break points in your app and count how long it takes to get from one to the other. This is where a good layered architecture helps a lot. Very rarely is the performance issue in the display code. So you can set a break point in the code that gets the data out of the database. When I did this this morning, I found that there was a foreach loop in the BLL that was retrieving data that could just as easily be placed in the store procedure that we were calling right above the foreach loop. That seemed to solve the problem until we put the code on stage. And, this is where the fun began. While the code was definitely faster, it was still too slow. What was perplexing was that the data seemed to be the same in our test database as it was on staging. Worse, we no longer had access to our debugger. So, how do you track a problem like this down? This is where the tracing feature of .NET is of great value. If you’ve never used this feature, you can read some other articles about it elsewhere (I’ll place links at the end) but for our purposes, we want to set up tracing a specific way.</p>\n<ol>\n<li>Place the following line in web.config</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">trace</span> <span class=\"attr\">enabled</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">requestLimit</span>=<span class=\"string\">&quot;10&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">pageOutput</span>=<span class=\"string\">&quot;false&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">traceMode</span>=<span class=\"string\">&quot;SortByTime&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">localOnly</span>=<span class=\"string\">&quot;false&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>This will enable tracing for your application but will not display the tracing information at the bottom of the page. Set localOnly to true if you can access the information from localhost–otherwise, you’ll need to set it to false.</p>\n<ol start=\"2\">\n<li>Put tracing statements in your code that you are trying to get timing information for.</li>\n</ol>\n<p>Now, here’s the part many people don’t know. While it is pretty simple to send trace statements out from the codebehind file using:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Trace.Write(<span class=\"string\">&quot;message&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>You can also access the Trace object and emit trace statements from your BLL and DAL code using:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HttpContext.Current.Trace</span><br><span class=\"line\">  .Write(<span class=\"string\">&quot;message&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>To access the trace output, run <a href=\"http://domaainstuff/applicationdirectory/trace.axd\">http://domaainstuff/applicationdirectory/trace.axd</a> and select the round trip you want to examine.</p>\n",
            "tags": [
                "asp.net",
                "httpcontext",
                "trace"
            ]
        },
        {
            "id": "http://davembush.github.com/test-sending-email-without-a-server-in-asp-net/",
            "url": "http://davembush.github.com/test-sending-email-without-a-server-in-asp-net/",
            "title": "Test Sending Email without a Server in ASP.NET",
            "date_published": "2013-06-05T07:36:19.000Z",
            "content_html": "<p><img src=\"/uploads/2009/08/back041.jpg\" alt=\"back-041\" title=\"back-041\"> By now, most people are familiar with the fact that ASP.NET will send mail from the codebehind by simply adding a few lines to your web.config file and adding another few lines of code in the codebehind file.</p>\n<p>But it wasn’t until recently that I found that you don’t need to have access to an SMTP server to test your code.</p>\n<span id=\"more\"></span>\n\n<p>In fact, this little trick will allow you to read the email without clogging up your email client with email you only wanted for testing purposes.</p>\n<p>Instead of the normal entry of</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mailSettings</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">smtp</span> <span class=\"attr\">from</span>=<span class=\"string\">&quot;you@domain.com&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">network</span> <span class=\"attr\">host</span>=<span class=\"string\">&quot;maiServerl&quot;</span> <span class=\"attr\">password</span>=<span class=\"string\">&quot;password&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">           <span class=\"attr\">userName</span>=<span class=\"string\">&quot;loginName&quot;</span> <span class=\"attr\">port</span>=<span class=\"string\">&quot;25&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">smtp</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mailSettings</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>You can use</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mailSettings</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">smtp</span> <span class=\"attr\">from</span>=<span class=\"string\">&quot;you@domain.com&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">deliveryMethod</span>=<span class=\"string\">&quot;SpecifiedPickupDirectory&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">specifiedPickupDirectory</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">pickupDirectoryLocation</span>=<span class=\"string\">&quot;c:\\\\mail&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">smtp</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mailSettings</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>This will drop your email message in the c:\\mail directory as an *.eml file which you can open with Outlook Express.</p>\n<p>The code you would write to send the mail is still the same:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SmtpClient smtp = <span class=\"keyword\">new</span> SmtpClient();</span><br><span class=\"line\">MailAddress <span class=\"keyword\">from</span> = <span class=\"keyword\">new</span> MailAddress(fromEmail, fromEmail);</span><br><span class=\"line\">MailAddress to = <span class=\"keyword\">new</span> MailAddress(emailAddress, emailAddress);</span><br><span class=\"line\">MailMessage message = <span class=\"keyword\">new</span> MailMessage(<span class=\"keyword\">from</span>, to);</span><br><span class=\"line\">message.Subject = SubjectLine;</span><br><span class=\"line\">message.Body = htmlString;</span><br><span class=\"line\">message.From = <span class=\"keyword\">from</span>;</span><br><span class=\"line\">message.To.Add(to);</span><br><span class=\"line\">message.IsBodyHtml = <span class=\"literal\">true</span>;</span><br><span class=\"line\">smtp.Send(message);</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "c#",
                "testing",
                "vb.net",
                "asp.net",
                "email",
                "mailaddress",
                "mailmessage",
                "smtpclient"
            ]
        },
        {
            "id": "http://davembush.github.com/multi-step-processing-in-asp-net/",
            "url": "http://davembush.github.com/multi-step-processing-in-asp-net/",
            "title": "Multi-Step Processing in ASP.NET",
            "date_published": "2013-05-08T05:32:51.000Z",
            "content_html": "<p><img src=\"/uploads/2010/04/B01I0045.jpg\" alt=\"B01I0045\" title=\"B01I0045\"></p>\n<p>I received the following question a few days ago but I’ve been so busy with billable work that I just haven’t had a chance to answer it until now.  Actually, I’m still busy, but I hate letting these questions go for too long.</p>\n<p>“Right now I am working on a project where I have to screen a user.  This is a multi-step process.  At the end of the process I store the data back to the system.</p>\n<p>Currently, I am storing all the options a user will select in a session variable and then finally using them at the last step.</p>\n<p>Can you please suggest a better way to store this temporary data that does not require using a session? This type of situation comes up a lot.  We’ve used multiview to get it working.</p>\n<span id=\"more\"></span>\n\n<p>But this does not seem to be viable in all situations.”</p>\n<p>If I had a multi-step process that I needed to complete, I’d probably use the ASP.NET Wizard Control, which is a lot like the MultiView control you mention.  The main difference is that it handles the navigation between the views for you.</p>\n<p>If your process requires you to navigate between separate ASPX pages, then you’ll probably want to do something with cross-page posting.</p>\n<p>Frankly, I don’t find session variables to be all that evil.  Your trade-offs are to either store all of the data on the page using hidden form variables or ASP.NET view state (using MultiView or Wizard controls), which makes the page heavier than it might otherwise be, or you need to store the information in session variables, which takes up memory on the server.</p>\n<p>For most web sites the extra memory used on the server is not an issue because the site just doesn’t get that much traffic.</p>\n<p>Unless we are talking about a 50-step process, storing the information in the page isn’t much of an issue either.</p>\n<p>Since you never state what it is about the MultiView control that makes it not viable in all situations, I’m left puzzled.  Seems like its cousin, the Wizard control, is exactly what you need.  I’m guessing there is something you don’t understand about how these controls should be used.</p>\n",
            "tags": [
                "asp.net",
                "session",
                "multiview",
                "wizard"
            ]
        },
        {
            "id": "http://davembush.github.com/asp-net-json-and-viewstate/",
            "url": "http://davembush.github.com/asp-net-json-and-viewstate/",
            "title": "ASP.NET JSON  and ViewState",
            "date_published": "2012-09-25T09:44:20.000Z",
            "content_html": "<p><img src=\"/uploads/2009/01/image5.png\" alt=\"image\">I received the following question recently about my article “<a href=\"/2008/08/04/aspnet-ajax-using-json-heres-how/\">ASP.NET AJAX using JSON - Here’s how.</a>“</p>\n<blockquote>\n<p>If we update the value of a textbox or label via a JSON web service call - will the value of that textbox&#x2F;label be written to the viewstate or whatever so that the server side code can see the new values that came from the JSON request?</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<p>The short answer is, “no, it will not update viewstate.”  But I think it would be helpful to understand when this is important rather than just giving you a blanket answer.</p>\n<p>First, let’s take a look at exactly how view state is handled in ASP.NET.</p>\n<p><img src=\"/uploads/2009/01/image5.png\" alt=\"image\"></p>\n<h2 id=\"Normal-Processing-of-an-ASP-NET-page\"><a href=\"#Normal-Processing-of-an-ASP-NET-page\" class=\"headerlink\" title=\"Normal Processing of an ASP.NET page\"></a>Normal Processing of an ASP.NET page</h2><p> When the browser first requests the ASPX page, the page is instantiated.  Since this is the first time it is being requested, there is no viewstate, so the deserialize step is skipped and the form elements step is skipped, and our page creation code is run.</p>\n<p> The magic happens right before the page is rendered and sent back to the client.  At this point, the state of all the <code>runat=&quot;server&quot;</code> elements we have on the page are serialized (stored) into the viewstate object which typically is stored in the hidden field on the form.  There are providers, however, that allow you to store this same information on the server someplace.  Then the HTML for the page is rendered and sent back to the browser.</p>\n<p> The next request from the browser using the same page is a POST form request.  The first thing that happens after the page is instantiated and all  the <code>runat=&quot;server&quot;</code> objects are instantiated, is that the viewstate is deserialized (retrieved from the viewstate object) so that by the time we get to the parsing of the form elements, all of our objects are back to exactly the same state that they were when we first sent the page back to the browser.</p>\n<p> Once the elements have been restored, the form elements are parsed and the appropriate properties on our form elements are set (Textbox.Text for example) and any events where we might need the change event fired are determined based on the difference between the view state and the current state of the form element.</p>\n<p> In the case of JSON calls, either using ASP.NET or jQuery, all we are updating is the element.  The question really becomes, “Does it matter?”</p>\n<h2 id=\"Does-it-matter\"><a href=\"#Does-it-matter\" class=\"headerlink\" title=\"Does it matter?\"></a>Does it matter?</h2><p> By default, all elements on the page are serialized and deserialized into and out of viewstate.  But in the case of things like a Textbox, most of the time we don’t care.  The fact of the matter is that most of our applications would work perfectly fine with viewstate turned off.</p>\n<p> Let’s take a look at what happens with a text box.</p>\n<p> When the text box is initially rendered on the page, it may have the current content from the database.  The person at the browser may change the form element and then submit the page.  Assuming we don’t need to fire the changed event on the server, the page is instantiated, the text box object is created, the text box object is restored to its original state and then immediately set to the content that was in the text box when the page was submitted.</p>\n<p> By the time we get to our event handling code, we don’t care, nor do we know, what the content of the field was the last time the page was sent back to the browser.  The code would work just as well with the viewstate for that element turned off.  This is mostly true of all the elements on the screen and since not all elements use viewstate to determine what events get fired it is more a matter of experimenting by turning viewstate off and seeing if the code still works than any hard and fast rule that determines if we need viewstate turned on for the element.</p>\n<p> The case of a label is different.  Since it is not a form element, but is rendered as a div, it’s content will not be sent back to the server with the post.  The only way of avoiding having to compute the value of the label is either by storing it in viewstate, or by storing it in viewstate or someplace on the server.</p>\n<h2 id=\"So-why-is-viewstate-turned-on-for-everything-by-default\"><a href=\"#So-why-is-viewstate-turned-on-for-everything-by-default\" class=\"headerlink\" title=\"So why is viewstate turned on for everything by default?\"></a>So why is viewstate turned on for everything by default?</h2><p>  Microsoft has a tendency to make the default behavior idiot proof.  They know that no one will read the documentation on how viewstate works or when it should be used.  So they set it up so that it will work for everyone out of the box.</p>\n<p>  I’ve seen enough “wrong” code and heard enough complaints about how this new model works to know that had Microsoft set it up so that turning viewstate on was an option and not the default, most programmers would still be using ASP at this point and ASP.NET would have been a dismal failure… and for those of you who think it is, it would have been an even bigger disaster.</p>\n<p>  In the case of using JSON with your ASP.NET code, your best bet would be to turn viewstate off for the page and assume that it isn’t going to do anything for you.  The point of JSON is to make your page more lightweight.  Turning viewstate on adds extra baggage to your HTML that you probably won’t need anyhow.</p>\n",
            "tags": [
                "asp.net",
                "json",
                "viewstate"
            ]
        },
        {
            "id": "http://davembush.github.com/prevent-postback-on-buttons/",
            "url": "http://davembush.github.com/prevent-postback-on-buttons/",
            "title": "Prevent Postback on Buttons",
            "date_published": "2010-10-11T13:04:04.000Z",
            "content_html": "<p><img src=\"/uploads/2010/10/IMG_1380.jpg\" alt=\"IMG_1380\" title=\"IMG_1380\"> Over the weekend I got a question about how to prevent postbacks on buttons from within jQuery tabs.  But the question really isn’t specific to jQuery.  There are other times when you might not want a button to post back.  So how do you do this? There are several ways you might accomplish this depending on what your goal is.  The first, and most obvious choice, is to not use an ASP:Button control and use an HTML input type&#x3D;”button” tag instead.  This will allow you to have full control over what is happening on the client side.  If at all possible, this should be your first choice.</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;button name&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>You will need to attach your own JavaScript to this so that it does what you want. If that doesn’t work for you, then you can make use of the OnClientClick property of the ASP:Button control (this also works for other controls that post back)</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">language</span>=<span class=\"string\">&quot;javascript&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">function</span> <span class=\"title function_\">javascriptfunction</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// other code you want to execute on the client side</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">asp:Button</span> <span class=\"attr\">ID</span>=<span class=\"string\">&quot;Button1&quot;</span> <span class=\"attr\">runat</span>=<span class=\"string\">&quot;server&quot;</span> <span class=\"attr\">Text</span>=<span class=\"string\">&quot;Button&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">OnClientClick</span>=<span class=\"string\">&quot;javascriptFunction&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>The “return false;” in the javascript function will cause the control to not post back.</p>\n",
            "tags": [
                "asp.net postback button"
            ]
        },
        {
            "id": "http://davembush.github.com/httpcontext-items-vs-session/",
            "url": "http://davembush.github.com/httpcontext-items-vs-session/",
            "title": "HttpContext.Items[] vs Session[]",
            "date_published": "2009-10-12T10:00:00.000Z",
            "content_html": "<p><img src=\"/uploads/2009/10/ETHN0171.png\" alt=\"ETHN0171\" title=\"ETHN0171\"></p>\n<p>Since .NET first became available, passing data around during a request has become a lot easier.  The ability to set a property has made that so.  Still, there are times when setting a property just won’t do the trick.</p>\n<span id=\"more\"></span>\n\n<p>One such time is getting data from the middle tier back up to the view separate from a DataBinding operation.  That is, you databind a control to the middle tier and that method needs to set a value that will be used elsewhere in the view, not in the item that is being bound.</p>\n<p>The natural, obvious tendency is to set a session variable.  But there is a better way.</p>\n<p>The problem with session variables is that they have to be cleaned up manually or they will hang around longer than we actually need them.  This will use up more session memory than is required and can potentially cause side effects that will be difficult to debug.</p>\n<p>Instead, you can use the Items[] collection that is part of the HttpContext class.  It works the same as a session variable, but it only hangs around for the duration of the request.  Once the information is sent back to the browser, the variables that were set in the Items[] collection go away.</p>\n<p>You might set your variable in the middle tier like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HttpContext.Current.Items[<span class=\"string\">&quot;myVar&quot;</span>] = <span class=\"string\">&quot;Some Data Here&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>And retrieve it later like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">string</span> myVar = (<span class=\"built_in\">string</span>)(HttpContext.Current.Items[<span class=\"string\">&quot;myVar&quot;</span>]);</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "httpcontext",
                "items",
                "session"
            ]
        },
        {
            "id": "http://davembush.github.com/dynamically-change-class-attribute-from-asp-net/",
            "url": "http://davembush.github.com/dynamically-change-class-attribute-from-asp-net/",
            "title": "Dynamically Change class Attribute From ASP.NET",
            "date_published": "2009-09-29T09:25:00.000Z",
            "content_html": "<p><img src=\"/uploads/2009/09/B03B0015.jpg\" alt=\"B03B0015\" title=\"B03B0015\"> I recently received a question from another programmer I know who’s been using PHP prior to ASP.NET that made me think harder about a problem we’ve all had in ASP.NET.  The basic problem is this:</p>\n<span id=\"more\"></span>\n\n<p>How do you dynamically change the class of a hyperlink based on the page name so that the hyperlink that represents the current page is styled differently than all the other hyperlinks on our screen?  If you want you can substitute any other HTML element you want, but the problem remains the same.</p>\n<p>The first, most obvious answer would be to create a case statement of some sort.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">string</span> fileName = AppRelativeVirtualPath</span><br><span class=\"line\">    .ToLower().Replace(<span class=\"string\">&quot;~/&quot;</span>,<span class=\"string\">&quot;&quot;</span>).Replace(<span class=\"string\">&quot;/&quot;</span>,<span class=\"string\">&quot;_&quot;</span>)</span><br><span class=\"line\">    .Replace(<span class=\"string\">&quot;.aspx&quot;</span>,<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">switch</span>(fileName)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">     <span class=\"keyword\">case</span> <span class=\"string\">&quot;fileone&quot;</span>:</span><br><span class=\"line\">             m_hyperLinkFileOne.CssClass =</span><br><span class=\"line\">                <span class=\"string\">&quot;selectedClass&quot;</span>;</span><br><span class=\"line\">             <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"comment\">// etc...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>But we all know just how ugly that code will get once we start adding pages to our site.   Yuck!  Unfortunately, this is exactly the code I’ve been recommending up until today.</p>\n<p>What was I thinking?!</p>\n<p>If you are familiar with ASP.NET at all, you should already be familiar with the Page_Load event handler.  I bet that’s where you do 90% of your page initialization.  But did you know that there is a load event that fires for each control?</p>\n<p>Further, you can have all of your controls point to the same load event handler.  So if we take advantage of this, we can write very tight code that automatically sets the class based on the current page name.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// This code assumes that the ID of the hyperLink</span></span><br><span class=\"line\"><span class=\"comment\">//  controls follow</span></span><br><span class=\"line\"><span class=\"comment\">// the form of m_hyperLinkDestinationPageName</span></span><br><span class=\"line\"><span class=\"comment\">// ie, a link to default.aspx would become</span></span><br><span class=\"line\"><span class=\"comment\">// m_hyperLinkDefault</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">HyperLinkLoad</span>(<span class=\"params\">Object sender, EventArgs args</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Only need to do this once if you have ViewState</span></span><br><span class=\"line\">    <span class=\"comment\">// enabled.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!IsPostBack)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">string</span> fileName = AppRelativeVirtualPath</span><br><span class=\"line\">            .ToLower().Replace(<span class=\"string\">&quot;~/&quot;</span>,<span class=\"string\">&quot;&quot;</span>).Replace(<span class=\"string\">&quot;/&quot;</span>,<span class=\"string\">&quot;_&quot;</span>)</span><br><span class=\"line\">            .Replace(<span class=\"string\">&quot;.aspx&quot;</span>,<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// sender will always point to the control that</span></span><br><span class=\"line\">        <span class=\"comment\">// fired the event so, assuming that only</span></span><br><span class=\"line\">        <span class=\"comment\">// asp:hyperlink controls call HyperLinkLoad</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"string\">&quot;m_hyperlink&quot;</span>+file ==</span><br><span class=\"line\">           ((HyperLinkControl)sender)</span><br><span class=\"line\">           .ID.ToLower())</span><br><span class=\"line\">           ((HyperLinkControl)sender).CssClass=</span><br><span class=\"line\">              <span class=\"string\">&quot;selectedClass&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "asp.net",
                "html",
                "class",
                "dynamic classing"
            ]
        },
        {
            "id": "http://davembush.github.com/unable-to-find-connection-for-object-web-config/",
            "url": "http://davembush.github.com/unable-to-find-connection-for-object-web-config/",
            "title": "Unable to find connection...for object web.config",
            "date_published": "2009-03-18T08:40:09.000Z",
            "content_html": "<p><img src=\"/uploads/2009/03/j01c0089.jpg\" alt=\"J01C0089\"> I’ve seen this error a couple of different times.  Mostly from other people calling me with the problem.  So I still don’t know what ultimately causes the problem.  But if you’re having this problem, here’s how you fix it.</p>\n<p>First, a bit of background.</p>\n<span id=\"more\"></span>\n\n<p>You’ll open a dataset you’ve been working with for months and see the following error message:</p>\n<blockquote>\n<p>Unable to find connection [connectionName] (web.config)1 for object ‘Web.config’.  The connection string could not be found in application settings, or the data provider associated with the connection string could not be loaded.</p>\n</blockquote>\n<p>What has happened is that the list of connection strings the tables in your dataset use has become corrupt.  In the most recent case of this we ended up with two connection strings with the same name pointing to two different connections. Here’s what you need to do to start trouble-shooting the problem.</p>\n<ul>\n<li>Close the dataset window with the error.</li>\n<li>Right click the dataset in the solution explorer</li>\n<li>Select “Open with…” from the context menu</li>\n<li>Select “Source Code (Text) Editor” from the list and press the “OK” button.</li>\n</ul>\n<p>Your code will now be opened in text mode so you can view the XML.  You want to be careful at this point because if you mess things up too badly, you won’t have anything useful.  As things stand now there is hope of recovery.  A backup would be a good thing to make sure you have right about now. Near the top of the file, you’ll see a &lt;connections&gt; element with several &lt;connection&gt; elements within it.  Most datasets should only have one &lt;connection&gt; element.  If you are having trouble like I’ve described above, you’ll have at least two and one will be incorrect.  Delete it or otherwise fix it, save the file and reopen normally.  If you are lucky, everything will be working correctly again.</p>\n",
            "tags": [
                "connection string",
                "dataset",
                "error",
                "web.config"
            ]
        },
        {
            "id": "http://davembush.github.com/infinite-302-loop-how-would-you-even-know/",
            "url": "http://davembush.github.com/infinite-302-loop-how-would-you-even-know/",
            "title": "Infinite 302 Loop - How would you even know?",
            "date_published": "2009-03-11T11:08:36.000Z",
            "content_html": "<p><img src=\"/uploads/2009/03/trav-053.jpg\" alt=\"trav-053\"> It happens eventually to all web developers.  It’s happened to me twice in the last week.  You make one simple change to your web site and then you can no longer access it.  When you browse to it in IE you get some completely useless “We can’t access the page you are looking for” error.  In FireFox, it at least tells you that you have a “Redirect Loop” and in IE6, if you are fortunate enough to still be writing for that browser, you can see that it is blinking at you as it tries to retrieve the page(s) multiple times.  But how do you know what’s redirecting to what?  For that matter, other than running a browser that told you, how would you even know it was a 302 error?</p>\n<span id=\"more\"></span>\n\n<p>I know I’ve mentioned this before but it’s definitely worth repeating.  Get yourself a copy of <a href=\"//www.telerik.com/fiddler\">Fiddler</a>. </p>\n<p>Fiddler is a proxy that runs on local host.  By default when you run it, it automatically installs itself as a proxy in IE so you really don’t have to know much more than how to install software to get up and running with it. When you access a web site with it, it will tell you everything that is going on.  What headers are being sent.  What headers are coming back from the server.  Files that are being requested.  Status codes that are coming back. Any time I have a client-side problem with my web sites, or any time I have a problem with my web sites that I can’t explain from the server side, I reach for Fiddler.  More often than not, it tells me or at least guides me to what the real problem is.</p>\n<p>For example, last week I was given the task of creating a 301 redirect from one domain to another.  I thought I had the code written correctly to do this, but when we went to access the domain it went into an infinite loop.  Obviously something was wrong, but what?</p>\n<p>When I ran similar code on other domains it worked correctly. When I ran Fiddler, I found that the page was redirecting to itself multiple times.  Odd.  What would make it do that?</p>\n<p>So back to my code, where I quickly discovered that I had left out a character in my replace function so that domain A was never being rewritten to domain B so domain A was constantly redirecting to itself.</p>\n<p>This morning’s error was a little more fun.  My designer was trying to install a module into DotNetNuke last night when the site suddenly “stopped working.” Same deal.  Only this time it is because there is some module that is redirecting from the home page to another page and then that other page is redirecting back to the home page. Again, I would have never been able to track this down if I hadn’t had Fiddler to help me.</p>\n<p>I’ve also used this to verify that javascript tracking codes are working correctly.  If you need to see traffic that is going between the browser and the server, Fiddler is the tool you are looking for.</p>\n",
            "tags": [
                "301",
                "302",
                "fiddler",
                "infinite loop"
            ]
        },
        {
            "id": "http://davembush.github.com/asp-net-application-error-detecting-404-s/",
            "url": "http://davembush.github.com/asp-net-application-error-detecting-404-s/",
            "title": "ASP.NET Application_Error Detecting 404's",
            "date_published": "2009-03-02T10:56:18.000Z",
            "content_html": "<p><img src=\"/uploads/2009/02/misc-vol3-046.jpg\" alt=\"misc_vol3_046\"> For many of you, this is going to be a “Duh!” kind of post.  But while working on this today, I found so many people asking this question and so many others giving the wrong answer, I’m compelled to post anyhow. If you know the answer, then you are welcome to stop reading now.  I didn’t write this for you.  I wrote this for the hundreds of people who will search for this information and won’t be able to find the answer.  The fact of the matter is, that’s why I write most of what I write–so people searching for the information can find it.  So here’s the question: I’ve set up an Application_Error event handler in my Global.asax file and I have implemented a server transfer for errors.  Now I want to set up a specific page to handle 404 errors.  How do I detect a 404 error and call the 404-specific page? The main answer to this question involves retrieving the exception that triggered the event in the first place.  To do that, we call <code>Server.GetLastError()</code>:</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exception ex = Server.GetLastError();</span><br></pre></td></tr></table></figure>\n\n<p>What we need to do next is determine if the exception is an HttpException or something else.  Once we have determined that it is an HttpException we will have access to Http-specific properties and methods that will give us the rest of the information we are looking for.  In our case we want to call the GetHttpCode() method, which will return the Http status code and compare it to the number 404. Our resulting code looks like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Application_Error</span>(<span class=\"params\"><span class=\"built_in\">object</span> sender, EventArgs e</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Exception ex = Server.GetLastError();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ex <span class=\"keyword\">is</span> HttpException)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (((HttpException)(ex)).GetHttpCode() == <span class=\"number\">404</span>)</span><br><span class=\"line\">            Server.Transfer(<span class=\"string\">&quot;~/Error404.aspx&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// Code that runs when an unhandled error occurs</span></span><br><span class=\"line\">    Server.Transfer(<span class=\"string\">&quot;~/DefaultError.aspx&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>That’s all there is to it.</p>\n",
            "tags": [
                "asp.net",
                "404",
                "application_error",
                "exceptions"
            ]
        },
        {
            "id": "http://davembush.github.com/tab-control-activetabindex-lost-on-postback/",
            "url": "http://davembush.github.com/tab-control-activetabindex-lost-on-postback/",
            "title": "Tab Control ActiveTabIndex Lost on Postback",
            "date_published": "2009-02-25T10:26:36.000Z",
            "content_html": "<p><img src=\"/uploads/2009/02/tran-land-01.jpg\" alt=\"tran-land-01\"> I just got off the phone with a client who is using the MS-AJAX TabControl in one of his applications and any time he causes a postback, the tab resets to the first tab.</p>\n<p>If you’ve never seen the problem, you’re lucky.  There are a couple of ways around the problem.  The first and easiest if it works in your situation is to put the tab in an update panel so that you never actually do a full postback.</p>\n<span id=\"more\"></span>\n\n<p>However, there are times when this won’t work.  In this particular case it is because one of the tabs holds the file upload control, which can’t be used inside an update panel.  (Another problem we had to find a way around last week.) What do you do then? Turns out this is a bug in the way that the tab works.  This problem turns up in various situations.  If you are fighting the bug, the solution is actually pretty simple.</p>\n<p>First, put the following  javascript in your aspx or ascx file:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">TabChanged</span>(<span class=\"params\">sender, args</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    sender.<span class=\"title function_\">get_clientStateField</span>().<span class=\"property\">value</span> =</span></span><br><span class=\"line\"><span class=\"language-javascript\">      sender.<span class=\"title function_\">saveClientState</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>And then wire up the TabChanged function to your tab control:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ajaxControlToolkit:TabContainer</span> <span class=\"attr\">ID</span>=<span class=\"string\">&quot;TabContainer1&quot;</span> <span class=\"attr\">runat</span>=<span class=\"string\">&quot;server&quot;</span> <span class=\"attr\">OnClientActiveTabChanged</span>=<span class=\"string\">&quot;TabChanged&quot;</span> &gt;</span></span><br><span class=\"line\">&lt;/ajaxControlToolkit:TabContainer\\&gt; /&gt;</span><br></pre></td></tr></table></figure>\n\n<p>This will fix the problem.</p>\n",
            "tags": [
                "ajax",
                "activetabindex",
                "postback",
                "tab control",
                "tabcontrol"
            ]
        },
        {
            "id": "http://davembush.github.com/asp-net-response-redirect-and-javascript/",
            "url": "http://davembush.github.com/asp-net-response-redirect-and-javascript/",
            "title": "ASP.NET Response.Redirect() and JavaScript",
            "date_published": "2009-01-28T10:10:10.000Z",
            "content_html": "<p><img src=\"/uploads/2009/01/toco-toucan.jpg\" alt=\"A toucan perched on a branch in Brazil.\"> Yesterday we covered issues surrounding using ASP.NET’s Response.Redirect in server side code. We noted that not handing it correctly could prevent code from running on the server that we want to run. The other issue is emitting Javascript in the server side in association with Response.Redirect(). This also leads to unexpected problems if you aren’t thinking about what is actually happening with your code.  Take this code as an example:</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">Page_Load</span>(<span class=\"params\"><span class=\"built_in\">object</span> sender, EventArgs e</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">string</span> myscript = <span class=\"string\">@&quot;&lt;script language=&#x27;javascript&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"string\">alert(&#x27;hello world&#x27;);</span></span><br><span class=\"line\"><span class=\"string\">&lt;/script&gt;&quot;</span>;</span><br><span class=\"line\">        ClientScript.RegisterClientScriptBlock</span><br><span class=\"line\">            (<span class=\"string\">&quot;&quot;</span>.GetType(), <span class=\"string\">&quot;s&quot;</span>, myscript);</span><br><span class=\"line\">        Response.Redirect(<span class=\"string\">&quot;~/newpage.aspx&quot;</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>The question is, why does the javascript never display “hello world”? Actually, the javascript is typically a little more complicated than “hello world.” But the question is always, “Why didn’t my javascript execute? It works fine without the redirect.” Once again, we need to think more clearly about what we’ve actually written. What we’ve actually told the server to do is the following:</p>\n<ol>\n<li>Render the javascript to display “hello world” in an alert box on the client.</li>\n<li>Set the header (not the header element, but the header that tells the browser whether the code executed successfully or not) to “302 redirect.”</li>\n</ol>\n<p>When the browser finally gets the stream back from the server, it will actually see step 2 first because the header comes before the javascript code. The browser will look at that 302, ignore everything else on the page, and faithfully redirect to the page specified as part of the 302.</p>\n",
            "tags": [
                "javascript",
                "asp.net",
                "302",
                "redirect",
                "response"
            ]
        },
        {
            "id": "http://davembush.github.com/response-redirect-executes-too-soon-on-the-server/",
            "url": "http://davembush.github.com/response-redirect-executes-too-soon-on-the-server/",
            "title": "Response.Redirect() executes too soon on the Server.",
            "date_published": "2009-01-27T10:43:45.000Z",
            "content_html": "<p><img src=\"/uploads/2009/01/tp-vol4-017.jpg\" alt=\"tp_vol4_017\"> I’ve seen this question a couple of times in various situations. The first involves Javascript and the second involves server side code. Both are caused by a misunderstanding of what this function does and how web pages work. Let’s start with the easy one: server side code.  You might have code that looks something like this:</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">Page_Load</span>(<span class=\"params\"><span class=\"built_in\">object</span> sender, EventArgs e</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Do something here</span></span><br><span class=\"line\">    Response.Redirect(<span class=\"string\">&quot;~/newpage.aspx&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// do some more code here</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>The problem with this code, which is probably obvious to most of you, is that the “do some more code here” section will never fire because we’ve done a redirect right before it. But is this as obvious?</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">Page_Load</span>(<span class=\"params\"><span class=\"built_in\">object</span> sender, EventArgs e</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Do something here</span></span><br><span class=\"line\">    Response.Redirect(<span class=\"string\">&quot;~/newpage.aspx&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">Button1_Click</span>(<span class=\"params\"><span class=\"built_in\">object</span> sender, EventArgs e</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do some more code here</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>The problem here is that Page_Load is the first event to fire. Button1_Click() will never execute because we’ve done the redirect during our page load. Aside from the fact that you should not perform form processing code during Page_Load(), the other issue is that events can fire in any order. So maybe you were smart and processed your form in a Button.Click event handler, but have you accounted for the fact that your databinding code may need to put data in the database AFTER you run Response.Redirect()? There is a way around this. Response.Redirect() has two overloads. The first, which we are all very used to, is the one I’ve shown above. But all it does is call the second which has two parameters, the URL and a boolean value, to indicate if we should stop processing right away and return to the browser. The default that gets sent in with the first overload is TRUE. Go ahead and quit. By modifying our code to:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">Page_Load</span>(<span class=\"params\"><span class=\"built_in\">object</span> sender, EventArgs e</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Do something here</span></span><br><span class=\"line\">    Response.Redirect(<span class=\"string\">&quot;~/newpage.aspx&quot;</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">Button1_Click</span>(<span class=\"params\"><span class=\"built_in\">object</span> sender, EventArgs e</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do some more code here</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>we can be sure that our Button1_Click method, or databinding code, will be executed. Tomorrow we’ll look at the issues involved with Javascript.</p>\n",
            "tags": [
                "asp.net",
                "events",
                "redirect",
                "response"
            ]
        },
        {
            "id": "http://davembush.github.com/systemexception-the-trust-relationship-between-the-primary-domain-and-the-trusted-domain-failed/",
            "url": "http://davembush.github.com/systemexception-the-trust-relationship-between-the-primary-domain-and-the-trusted-domain-failed/",
            "title": "SystemException: The trust relationship between the primary domain and the trusted domain failed",
            "date_published": "2008-11-18T11:14:06.000Z",
            "content_html": "<p><img src=\"/uploads/2008/11/a03b0015.jpg\" alt=\"A03B0015\"> I hate long titles, but this is what everyone is going to be searching for if they get this error, so that’s the title today.</p>\n<p>I just got done fixing an error and when I went to Google, there were only five entries for this phrase and none of them solved the problem.  Some got me close and gave me a clue, but none of them said…</p>\n<span id=\"more\"></span>\n\n<blockquote>\n<p>Hey dummy, you forgot to put in the forms authentication section in your web.config file and now you are asking for role information.  What gives?!</p>\n</blockquote>\n<p>So, if you are getting this error, go check your web.config file for the forms authentication section.  I just did  a search in mine for “authentication” until I found the section that had been commented out.</p>\n<p>I’m not saying this IS your problem, but it was the solution to MY problem and it might just help someone to have it here.</p>\n",
            "tags": []
        },
        {
            "id": "http://davembush.github.com/asp-net-ajax-using-json-here-s-how/",
            "url": "http://davembush.github.com/asp-net-ajax-using-json-here-s-how/",
            "title": "ASP.NET AJAX using JSON - Here's how.",
            "date_published": "2008-08-04T11:05:58.000Z",
            "content_html": "<p><img src=\"/uploads/2008/08/image.png\" alt=\"image\"> Last week I wrote a post about <a href=\"/2008/07/30/using-json-in-aspnet/\">how simple JSON is</a>.</p>\n<p>In it I explained the main differences between using JSON and using the update panel. I really started out thinking I’d get to how to write JSON code, but I ran out of space. Well, today, we get to the HOW.</p>\n<span id=\"more\"></span>\n\n<p>All JSON really is, is the ability to have JavaScript code call a WebService for our data, and write it into the HTML on the client side.</p>\n<p>If you know anything about how to write a WebService, this should be rather trivial because your web service is going to look just like any other web service with the exception of an added attribute.  To make a WebService accessible to JSON, add the following Attribute to your WebService class:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">ScriptService</span>]</span><br></pre></td></tr></table></figure>\n\n<p>You will probably also need to add</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System.Web.Script.Services;</span><br></pre></td></tr></table></figure>\n\n<p>to the top of your page.</p>\n<p>Now, any WebMethod in your WebService can be called by your JavaScript on the client side. As with any AJAX code in ASP.NET, you’ll need to add a ScriptManager to your page.</p>\n<p>But, in addition, you’ll also need to add a Services section in your ScriptManager to tell the ASP.NET page to pull in the javascript that the WebService code will now produce for you.</p>\n<p>You should have this code at the top of the FORM section of your HTML.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">asp:ScriptManager</span> <span class=\"attr\">ID</span>=<span class=\"string\">&quot;ScriptManager1&quot;</span> <span class=\"attr\">runat</span>=<span class=\"string\">&quot;server&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Services</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">asp:ServiceReference</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;~/WebService.asmx&quot;</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Services</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">asp:ScriptManager</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Where, <code>~/WebService.asmx</code> refers to the web service you want to be able to access. Now in the javascript event handler where you want to be able to call the WebService, you just call the WebService similar to how you would call any other function. In fact, if you write this code in the ASPX page, you will even get intellisense. So, assuming we have a class named <code>WebService</code> with a function called “HelloWorld” that returns a string, our calling code will look like:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WebService.HelloWorld(Success,Fail,<span class=\"literal\">null</span>);</span><br></pre></td></tr></table></figure>\n\n<p>Note that our call takes three parameters, even though our function in the WebService does not take any parameters.</p>\n<p>The first parameter is a pointer to a JavaScript function to call if the call to the WebService succeeds.</p>\n<p>The second is a pointer to the JavaScript function to call if the WebService call fails, and the third parameter is a JavaScript context object to pass to the Success function.</p>\n<p>Since I don’t have any data I need to pass along, I just pass in NULL in the code above. If the WebService method takes parameters, the parameters are listed before the success, fail, and context parameters. If the WebService call fails, the JavaScript function that we specified for fail will be called. It needs to accept one parameter which will have the error message in it. You can use this to display an error message in an alert box. When the WebService returns successfully, the Success function will be called. This function takes two parameters. The first is the return value. The second is the context object we passed when we originally called the WebMethod. You can then use standard JavaScript to find an HTML element on the page to put the new content into:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Success</span>(<span class=\"params\">result,context</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;fillMeAtLoadTime&quot;</span>).<span class=\"property\">innerHTML</span> = result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And that’s really all there is to JSON. The rest is really just a matter of imagination and JavaScript.</p>\n",
            "tags": [
                "asp.net",
                "ajax",
                "json"
            ]
        },
        {
            "id": "http://davembush.github.com/virtual-files-using-httpcontext-rewritepath/",
            "url": "http://davembush.github.com/virtual-files-using-httpcontext-rewritepath/",
            "title": "Virtual Files using HttpContext.RewritePath()",
            "date_published": "2008-07-17T06:25:56.000Z",
            "content_html": "<p>One of the cool new tricks we are able to perform in ASP.NET that we were not able to use in ASP is the ability to have ASP.NET redirect file requests in the same way that mod_rewrite does under the Apache webserver.</p>\n<p>For example, we could have the browser ask for an image file that doesn’t exist on the file system and have ASP.NET serve up the file from the database.</p>\n<span id=\"more\"></span>\n\n<p>Or, if we wanted to protect some files, we could put them in a directory that was hard to guess and have ASP.NET load that file for us when the browser requested the file from what looked like a normal location.</p>\n<p>The magic that makes all this work is the 404 error handler, the Application_BeginRequest() event handler, and the HttpContext.RewritePath() method.</p>\n<p>So, the first thing we need to do is open up our Global.asax file and create an event handler for BeginRequest().</p>\n<p>This event is the first thing that will get called when a request is made to ASP.NET.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">Application_BeginRequest</span>(<span class=\"params\">Object sender, EventArgs e</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Second, we will want to create a 404 error handler in IIS.</p>\n<p>You may have done this in prior applications, like ASP, to tell the user that a page no longer existed or to redirect the browser to a page whose name had changed.</p>\n<p>We are going to use it to force the <code>Application_BeginRequest()</code> method to fire even when a static file isn’t found.</p>\n<p>All you need to do is tell IIS that an ASPX file is the 404 handler. It doesn’t matter what you call it and it doesn’t matter if the file even exists on the server. The only thing that does matter is that you SAY that the file exists in the application directory that you’ve created your web application in.</p>\n<p>Now that you’ve specified your 404 handler, any file that can’t be found on the server will automatically fire the <code>Application_BeginRequest</code> event handler. So the next thing we need to do is add code in this method to check for the 404 condition.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (Request.ServerVariables[<span class=\"string\">&quot;QUERY_STRING&quot;</span>].Length &gt; <span class=\"number\">4</span> &amp;&amp;</span><br><span class=\"line\">Request.ServerVariables[<span class=\"string\">&quot;QUERY_STRING&quot;</span>].StartsWith(<span class=\"string\">&quot;404;&quot;</span>))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  Context.Trace.Write(<span class=\"string\">&quot;QueryString &gt; 1&quot;</span>);</span><br><span class=\"line\">  String queryString =</span><br><span class=\"line\">    Request.ServerVariables[<span class=\"string\">&quot;QUERY_STRING&quot;</span>].Substring(<span class=\"number\">4</span>).ToLower();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// strip off the http:// or https://</span></span><br><span class=\"line\">  queryString = queryString.Replace(<span class=\"string\">&quot;http://&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    .Replace(<span class=\"string\">&quot;https://&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// strip of the host section</span></span><br><span class=\"line\">  queryString = queryString.Substring(queryString.IndexOf(<span class=\"string\">&quot;/&quot;</span>) + <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">string</span> applicationDirectory = Request.ApplicationPath;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (applicationDirectory.StartsWith(<span class=\"string\">&quot;/&quot;</span>))</span><br><span class=\"line\">    applicationDirectory = applicationDirectory.Substring(<span class=\"number\">1</span>);</span><br><span class=\"line\">  queryString = queryString.Substring(applicationDirectory.Length);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (queryString.ToCharArray()[<span class=\"number\">0</span>] != <span class=\"string\">&#x27;/&#x27;</span>)</span><br><span class=\"line\">    queryString = <span class=\"string\">&quot;/&quot;</span> + queryString;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Remember from your ASP days, when a 404 error handler is called, the query string starts with “404;”, so this code is checking for that and stripping it out. Then it looks for the file that was being requested and strips off everything but the file location. This code will work if your application is in a subdirectory or if it is in the root of your domain, leaving you with an application relative reference to the file the browser was looking for. Once you have that, you can format the request to the real location and call</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HttpContext.Current.RewritePath(newLocation)</span><br></pre></td></tr></table></figure>\n\n<p>Passing in the call to an ASPX file that will actually return the correct information.</p>\n<p>In the code that I originally wrote, this was looking for our virtual images directory and passed the call on to our virtual images handler which pulls the image out of the database.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (queryString.StartsWith(imagesDirectory))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  HttpContext.Current.RewritePath(<span class=\"string\">&quot;VirtualImage.aspx?&quot;</span>+queryString);</span><br><span class=\"line\">  <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And, just to preempt any comments about performance, the VirtualImage.aspx file caches the results so that we are not constantly pulling the image from the database. Here’s the full handler:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">Application_BeginRequest</span>(<span class=\"params\">Object sender, EventArgs e</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (Request.ServerVariables[<span class=\"string\">&quot;QUERY_STRING&quot;</span>].Length &gt; <span class=\"number\">4</span> &amp;&amp;</span><br><span class=\"line\">    Request.ServerVariables[<span class=\"string\">&quot;QUERY_STRING&quot;</span>].StartsWith(<span class=\"string\">&quot;404;&quot;</span>)) &#123;</span><br><span class=\"line\">      Context.Trace.Write(<span class=\"string\">&quot;QueryString &gt; 1&quot;</span>);</span><br><span class=\"line\">      String queryString =</span><br><span class=\"line\">        Request.ServerVariables[<span class=\"string\">&quot;QUERY_STRING&quot;</span>]</span><br><span class=\"line\">          .Substring(<span class=\"number\">4</span>)</span><br><span class=\"line\">          .ToLower();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// strip off the http:// or https://</span></span><br><span class=\"line\">      queryString = queryString</span><br><span class=\"line\">        .Replace(<span class=\"string\">&quot;http://&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">        .Replace(<span class=\"string\">&quot;https://&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// strip of the host section</span></span><br><span class=\"line\">      queryString = queryString</span><br><span class=\"line\">        .Substring(queryString.IndexOf(<span class=\"string\">&quot;/&quot;</span>) + <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"built_in\">string</span> applicationDirectory = Request.ApplicationPath;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (applicationDirectory.StartsWith(<span class=\"string\">&quot;/&quot;</span>))</span><br><span class=\"line\">        applicationDirectory = applicationDirectory.Substring(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      queryString = queryString</span><br><span class=\"line\">        .Substring(applicationDirectory.Length);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (queryString.ToCharArray()[<span class=\"number\">0</span>] != <span class=\"string\">&#x27;/&#x27;</span>)</span><br><span class=\"line\">        queryString = <span class=\"string\">&quot;/&quot;</span> + queryString;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">string</span> imagesDirectory =</span><br><span class=\"line\">      ConfigurationManager.AppSettings[<span class=\"string\">&quot;VirtualImageDirectory&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (queryString.StartsWith(imagesDirectory)) &#123;</span><br><span class=\"line\">      HttpContext.Current.</span><br><span class=\"line\">        RewritePath(<span class=\"string\">&quot;VirtualImage.aspx?&quot;</span>+queryString);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (queryString.Contains(<span class=\"string\">&quot;app_themes&quot;</span>))</span><br><span class=\"line\">    HttpContext.Current.</span><br><span class=\"line\">      RewritePath(<span class=\"string\">&quot;ResolveRelativeReference.aspx?&quot;</span> +</span><br><span class=\"line\">      queryString);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://davembush.github.com/asp-net-gridview-edit-all-rows-at-once/",
            "url": "http://davembush.github.com/asp-net-gridview-edit-all-rows-at-once/",
            "title": "ASP.NET GridView Edit All Rows At Once",
            "date_published": "2007-10-30T11:23:15.000Z",
            "content_html": "<p>I just saw a question about this yesterday and realized that while I know how to do this, not everyone does.  So, here we go…</p>\n<p>Here’s the problem.  You want to be able to edit all the rows in the gridview at once instead of having to switch to edit mode and save one row at the time.  Normally, you’d want to do this when only a couple of items need to be changed per row and not the entire row’s worth of data.</p>\n<p><img src=\"/uploads/2016/03/image-1.png\" alt=\"image\" title=\"image\"></p>\n<p>Photo credit: <a href=\"//www.flickr.com/photos/tico24/16673795/\">tico_24</a> via <a href=\"//visualhunt.com\">VisualHunt.com</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\">CC BY</a></p>\n<span id=\"more\"></span>\n\n<p>You can do this easily if you make the columns that need to be edited templated columns and place editable controls in them (checkbox, textbox, etc)  You can then either make these controls “AutoPostback” controls, or you can provide a control at the bottom of the screen that triggers the update.  In either case, the code you are going to write at the codebehind level is going to be the same.</p>\n<p>For this example, we are going to assume that you only have one column that needs to be updated and that the control is a checkbox control.</p>\n<p>One of the issues you are going to run into with this is that you’ll need to know which row is associated with the control when it is updated.  The easiest way I’ve found of dealing with this problem is by adding a HiddenField control and databinding the row Id to it.  Since we are dealing with a CheckBox control, you will need to create an event handler for the Checked event.  The first parameter that will be passed into this event handler will be the sender.  Sender represents the control that fired the event.  In this case, it will represent the CheckBox control.</p>\n<p>The other control you’ll need to retrieve is the HiddenField control that you placed next to the check box.  You can retrieve this control by using the FindControl() method that is hanging off the parent control of the check box.  Assuming your HiddenField control is named “_hiddenFieldId” you can get the ID by using:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">string</span> id = (HiddenField)(((CheckBox)(Sender)).Parent</span><br><span class=\"line\">    .FindControl(<span class=\"string\">&quot;_hiddenFieldId&quot;</span>)).Text;</span><br></pre></td></tr></table></figure>\n\n<p>Now that you have the value of the ID and the value of the checkbox, you can update your database.</p>\n",
            "tags": [
                "asp.net",
                "tutorial",
                "gridview"
            ]
        }
    ]
}